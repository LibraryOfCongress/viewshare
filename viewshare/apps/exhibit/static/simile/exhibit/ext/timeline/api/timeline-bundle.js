/**
 * @license RequireJS i18n 2.0.3 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/i18n for details
 */

/*
     *  inserting copyright and link
     */

define("scripts/timeline-base",["simile-ajax"],function(e){var t={version:"3.0.0",ajax_lib_version:"3.0.0",loaded:!1,display_version:null,HORIZONTAL:0,VERTICAL:1,_defaultTheme:null,urlPrefix:null,serverLocale:null,clientLocale:null,timelines:null,cssFiles:["styles/main.css"],bundledCssFile:"styles/timeline-bundle.css",params:{bundle:!0,ajax:null},paramTypes:{bundle:Boolean,ajax:String},supportedLocales:["cs","de","en","es","fr","it","nl","pl","ru","se","tr","vi","zh"]};return t.display_version=t.version+" (with Ajax lib "+t.ajax_lib_version+")",t}),function(){function t(e,t,n,r,i,s){t[e]&&(n.push(e),(t[e]===!0||t[e]===1)&&r.push(i+e+"/"+s))}function n(e,t,n,r,i){var s=r+t+"/"+i;require._fileExists(e.toUrl(s+".js"))&&n.push(s)}function r(e,t,n){var i;for(i in t)t.hasOwnProperty(i)&&(!e.hasOwnProperty(i)||n)?e[i]=t[i]:typeof t[i]=="object"&&(e[i]||(e[i]={}),r(e[i],t[i],n))}var e=/(^.*(^|\/)nls(\/|$))([^\/]*)\/?([^\/]*)/;define("i18n",["module"],function(i){var s=i.config?i.config():{};return{version:"2.0.3",load:function(i,o,u,a){a=a||{},a.locale&&(s.locale=a.locale);var f,l=e.exec(i),c=l[1],h=l[4],p=l[5],d=h.split("-"),v=[],m={},g,y,b="";l[5]?(c=l[1],f=c+p):(f=i,p=l[4],h=s.locale,h||(h=s.locale=typeof navigator=="undefined"?"root":(navigator.language||navigator.userLanguage||"root").toLowerCase()),d=h.split("-"));if(a.isBuild){v.push(f),n(o,"root",v,c,p);for(g=0;g<d.length;g++)y=d[g],b+=(b?"-":"")+y,n(o,b,v,c,p);o(v,function(){u()})}else o([f],function(e){var n=[],i;t("root",e,n,v,c,p);for(g=0;g<d.length;g++)i=d[g],b+=(b?"-":"")+i,t(b,e,n,v,c,p);o(v,function(){var t,i,s;for(t=n.length-1;t>-1&&n[t];t--){s=n[t],i=e[s];if(i===!0||i===1)i=o(c+s+"/"+p);r(m,i)}u(m)})})}}})}(),define("nls/months",{root:!0,cs:!0,de:!0,es:!0,fr:!0,it:!0,nl:!0,pl:!0,"pt-br":!0,ru:!0,se:!0,tr:!0,vi:!0,zh:!0}),define("nls/root/months",{0:"Jan",1:"Feb",2:"Mar",3:"Apr",4:"May",5:"Jun",6:"Jul",7:"Aug",8:"Sep",9:"Oct",10:"Nov",11:"Dec"}),define("nls/timeline",{root:!0,cs:!0,de:!0,es:!0,fr:!0,it:!0,nl:!0,pl:!0,"pt-br":!0,ru:!0,se:!0,tr:!0,vi:!0,zh:!0}),define("nls/root/timeline",{dateStyle:"en",wikiLinkLabel:"Discuss"}),define("scripts/labellers",["simile-ajax","i18n!nls/months","i18n!nls/timeline"],function(e,t,n){var r=function(e,t){this._locale=e,this._timeZone=t};return r.monthNames=[],r.dayNames=[],r.labelIntervalFunctions=[],r.getMonthName=function(e,n){return t[e.toString()]},r.prototype.labelInterval=function(e,t){var n=r.labelIntervalFunctions[this._locale];return n==null&&(n=r.prototype.defaultLabelInterval),n.call(this,e,t)},r.prototype.labelPrecise=function(t){return e.DateTime.removeTimeZoneOffset(t,this._timeZone).toUTCString()},r.prototype.defaultLabelInterval=function(t,i){var s,o=!1;t=e.DateTime.removeTimeZoneOffset(t,this._timeZone);switch(i){case e.DateTime.MILLISECOND:s=t.getUTCMilliseconds();break;case e.DateTime.SECOND:s=t.getUTCSeconds();break;case e.DateTime.MINUTE:var u=t.getUTCMinutes();u==0?(s=t.getUTCHours()+":00",o=!0):s=u;break;case e.DateTime.HOUR:s=t.getUTCHours()+"hr";break;case e.DateTime.DAY:n.dateStyle==="cs"?s=t.getUTCDate()+". "+(t.getUTCMonth()+1)+".":n.dateStyle==="vi"?s=t.getUTCDate()+"/"+(t.getUTCMonth()+1):n.dateStyle==="de"?s=t.getUTCDate()+". "+r.getMonthName(t.getUTCMonth(),this._locale):n.dateStyle==="zh"?s=r.getMonthName(t.getUTCMonth(),this._locale)+t.getUTCDate()+"日":s=r.getMonthName(t.getUTCMonth(),this._locale)+" "+t.getUTCDate();break;case e.DateTime.WEEK:n.dateStyle==="cs"?s=t.getUTCDate()+". "+(t.getUTCMonth()+1)+".":n.dateStyle==="vi"?s=t.getUTCDate()+"/"+(t.getUTCMonth()+1):n.dateStyle==="de"?s=t.getUTCDate()+". "+r.getMonthName(t.getUTCMonth(),this._locale):n.dateStyle==="zh"?s=r.getMonthName(t.getUTCMonth(),this._locale)+t.getUTCDate()+"日":s=r.getMonthName(t.getUTCMonth(),this._locale)+" "+t.getUTCDate();break;case e.DateTime.MONTH:var u=t.getUTCMonth();if(u!=0){s=r.getMonthName(u,this._locale);break};case e.DateTime.YEAR:case e.DateTime.DECADE:case e.DateTime.CENTURY:case e.DateTime.MILLENNIUM:var a=t.getUTCFullYear();a>0?s=t.getUTCFullYear():s=1-a+"BC",o=i==e.DateTime.MONTH||i==e.DateTime.DECADE&&a%100==0||i==e.DateTime.CENTURY&&a%1e3==0;break;default:s=t.toUTCString()}return{text:s,emphasized:o}},r}),define("scripts/band",["simile-ajax","./timeline-base","./labellers"],function(e,t,n){var r=function(r,i,s){r.autoWidth&&typeof i.width=="string"&&(i.width=i.width.indexOf("%")>-1?0:parseInt(i.width)),this._timeline=r,this._bandInfo=i,this._index=s,this._locale="locale"in i?i.locale:t.getDefaultLocale(),this._timeZone="timeZone"in i?i.timeZone:0,this._labeller="labeller"in i?i.labeller:"createLabeller"in r.getUnit()?r.getUnit().createLabeller(this._locale,this._timeZone):new n(this._locale,this._timeZone),this._theme=i.theme,this._zoomIndex="zoomIndex"in i?i.zoomIndex:0,this._zoomSteps="zoomSteps"in i?i.zoomSteps:null,this._dragging=!1,this._changing=!1,this._originalScrollSpeed=5,this._scrollSpeed=this._originalScrollSpeed,this._onScrollListeners=[],this._orthogonalDragging=!1,this._viewOrthogonalOffset=0,this._onOrthogonalScrollListeners=[];var o=this;this._syncWithBand=null,this._syncWithBandHandler=function(e){o._onHighlightBandScroll()},this._syncWithBandOrthogonalScrollHandler=function(e){o._onHighlightBandOrthogonalScroll()},this._selectorListener=function(e){o._onHighlightBandScroll()};var u=this._timeline.getDocument().createElement("div");u.className="timeline-band-input",this._timeline.addDiv(u),this._keyboardInput=document.createElement("input"),this._keyboardInput.type="text",u.appendChild(this._keyboardInput),e.DOM.registerEventWithObject(this._keyboardInput,"keydown",this,"_onKeyDown"),e.DOM.registerEventWithObject(this._keyboardInput,"keyup",this,"_onKeyUp"),this._div=this._timeline.getDocument().createElement("div"),this._div.id="timeline-band-"+s,this._div.className="timeline-band timeline-band-"+s,this._timeline.addDiv(this._div),e.DOM.registerEventWithObject(this._div,"dblclick",this,"_onDblClick"),e.DOM.registerEventWithObject(this._div,"mousedown",this,"_onMouseDown"),e.DOM.registerEventWithObject(document.body,"mousemove",this,"_onMouseMove"),e.DOM.registerEventWithObject(document.body,"mouseup",this,"_onMouseUp"),e.DOM.registerEventWithObject(document.body,"mouseout",this,"_onMouseOut");var a=this._theme!=null?this._theme.mouseWheel:"scroll";if(a==="zoom"||a==="scroll"||this._zoomSteps)e.Platform.browser.isFirefox?e.DOM.registerEventWithObject(this._div,"DOMMouseScroll",this,"_onMouseScroll"):e.DOM.registerEventWithObject(this._div,"mousewheel",this,"_onMouseScroll");this._innerDiv=this._timeline.getDocument().createElement("div"),this._innerDiv.className="timeline-band-inner",this._div.appendChild(this._innerDiv),this._ether=i.ether,i.ether.initialize(this,r),this._etherPainter=i.etherPainter,i.etherPainter.initialize(this,r),this._eventSource=i.eventSource,this._eventSource&&(this._eventListener={onAddMany:function(){o._onAddMany()},onClear:function(){o._onClear()}},this._eventSource.addListener(this._eventListener)),this._eventPainter=i.eventPainter,this._eventTracksNeeded=0,this._eventTrackIncrement=0,i.eventPainter.initialize(this,r),this._decorators="decorators"in i?i.decorators:[];for(var f=0;f<this._decorators.length;f++)this._decorators[f].initialize(this,r);this._supportsOrthogonalScrolling="supportsOrthogonalScrolling"in this._eventPainter&&this._eventPainter.supportsOrthogonalScrolling();if(this._supportsOrthogonalScrolling){this._scrollBar=this._timeline.getDocument().createElement("div"),this._scrollBar.id="timeline-band-scrollbar-"+s,this._scrollBar.className="timeline-band-scrollbar",this._timeline.addDiv(this._scrollBar),this._scrollBar.innerHTML='<div class="timeline-band-scrollbar-thumb"> </div>';var l=this._scrollBar.firstChild;e.Platform.browser.isIE?l.style.cursor="move":l.style.cursor="-moz-grab",e.DOM.registerEventWithObject(l,"mousedown",this,"_onScrollBarMouseDown")}};return r.SCROLL_MULTIPLES=5,r.prototype.dispose=function(){this.closeBubble(),this._eventSource&&(this._eventSource.removeListener(this._eventListener),this._eventListener=null,this._eventSource=null),this._timeline=null,this._bandInfo=null,this._labeller=null,this._ether=null,this._etherPainter=null,this._eventPainter=null,this._decorators=null,this._onScrollListeners=null,this._syncWithBandHandler=null,this._syncWithBandOrthogonalScrollHandler=null,this._selectorListener=null,this._div=null,this._innerDiv=null,this._keyboardInput=null,this._scrollBar=null},r.prototype.addOnScrollListener=function(e){this._onScrollListeners.push(e)},r.prototype.removeOnScrollListener=function(e){for(var t=0;t<this._onScrollListeners.length;t++)if(this._onScrollListeners[t]==e){this._onScrollListeners.splice(t,1);break}},r.prototype.addOnOrthogonalScrollListener=function(e){this._onOrthogonalScrollListeners.push(e)},r.prototype.removeOnOrthogonalScrollListener=function(e){for(var t=0;t<this._onOrthogonalScrollListeners.length;t++)if(this._onOrthogonalScrollListeners[t]==e){this._onOrthogonalScrollListeners.splice(t,1);break}},r.prototype.setSyncWithBand=function(e,t){this._syncWithBand&&(this._syncWithBand.removeOnScrollListener(this._syncWithBandHandler),this._syncWithBand.removeOnOrthogonalScrollListener(this._syncWithBandOrthogonalScrollHandler)),this._syncWithBand=e,this._syncWithBand.addOnScrollListener(this._syncWithBandHandler),this._syncWithBand.addOnOrthogonalScrollListener(this._syncWithBandOrthogonalScrollHandler),this._highlight=t,this._positionHighlight()},r.prototype.getLocale=function(){return this._locale},r.prototype.getTimeZone=function(){return this._timeZone},r.prototype.getLabeller=function(){return this._labeller},r.prototype.getIndex=function(){return this._index},r.prototype.getEther=function(){return this._ether},r.prototype.getEtherPainter=function(){return this._etherPainter},r.prototype.getEventSource=function(){return this._eventSource},r.prototype.getEventPainter=function(){return this._eventPainter},r.prototype.getTimeline=function(){return this._timeline},r.prototype.updateEventTrackInfo=function(e,t){this._eventTrackIncrement=t,e>this._eventTracksNeeded&&(this._eventTracksNeeded=e)},r.prototype.checkAutoWidth=function(){if(!this._timeline.autoWidth)return;var e=this._eventPainter.getType()=="overview",t=e?this._theme.event.overviewTrack.autoWidthMargin:this._theme.event.track.autoWidthMargin,n=Math.ceil((this._eventTracksNeeded+t)*this._eventTrackIncrement);n+=e?this._theme.event.overviewTrack.offset:this._theme.event.track.offset;var r=this._bandInfo;n!=r.width&&(r.width=n)},r.prototype.layout=function(){this.paint()},r.prototype.paint=function(){this._etherPainter.paint(),this._paintDecorators(),this._paintEvents()},r.prototype.softLayout=function(){this.softPaint()},r.prototype.softPaint=function(){this._etherPainter.softPaint(),this._softPaintDecorators(),this._softPaintEvents()},r.prototype.setBandShiftAndWidth=function(e,t){var n=this._keyboardInput.parentNode,r=e+Math.floor(t/2);this._timeline.isHorizontal()?(this._div.style.top=e+"px",this._div.style.height=t+"px",n.style.top=r+"px",n.style.left="-1em"):(this._div.style.left=e+"px",this._div.style.width=t+"px",n.style.left=r+"px",n.style.top="-1em")},r.prototype.getViewWidth=function(){return this._timeline.isHorizontal()?this._div.offsetHeight:this._div.offsetWidth},r.prototype.setViewLength=function(e){this._viewLength=e,this._recenterDiv(),this._onChanging()},r.prototype.getViewLength=function(){return this._viewLength},r.prototype.getTotalViewLength=function(){return r.SCROLL_MULTIPLES*this._viewLength},r.prototype.getViewOffset=function(){return this._viewOffset},r.prototype.getMinDate=function(){return this._ether.pixelOffsetToDate(this._viewOffset)},r.prototype.getMaxDate=function(){return this._ether.pixelOffsetToDate(this._viewOffset+r.SCROLL_MULTIPLES*this._viewLength)},r.prototype.getMinVisibleDate=function(){return this._ether.pixelOffsetToDate(0)},r.prototype.getMinVisibleDateAfterDelta=function(e){return this._ether.pixelOffsetToDate(e)},r.prototype.getMaxVisibleDate=function(){return this._ether.pixelOffsetToDate(this._viewLength)},r.prototype.getMaxVisibleDateAfterDelta=function(e){return this._ether.pixelOffsetToDate(this._viewLength+e)},r.prototype.getCenterVisibleDate=function(){return this._ether.pixelOffsetToDate(this._viewLength/2)},r.prototype.setMinVisibleDate=function(e){this._changing||this._moveEther(Math.round(-this._ether.dateToPixelOffset(e)))},r.prototype.setMaxVisibleDate=function(e){this._changing||this._moveEther(Math.round(this._viewLength-this._ether.dateToPixelOffset(e)))},r.prototype.setCenterVisibleDate=function(e){this._changing||this._moveEther(Math.round(this._viewLength/2-this._ether.dateToPixelOffset(e)))},r.prototype.dateToPixelOffset=function(e){return this._ether.dateToPixelOffset(e)-this._viewOffset},r.prototype.pixelOffsetToDate=function(e){return this._ether.pixelOffsetToDate(e+this._viewOffset)},r.prototype.getViewOrthogonalOffset=function(){return this._viewOrthogonalOffset},r.prototype.setViewOrthogonalOffset=function(e){this._viewOrthogonalOffset=Math.max(0,e)},r.prototype.createLayerDiv=function(t,n){var r=this._timeline.getDocument().createElement("div");r.className="timeline-band-layer"+(typeof n=="string"?" "+n:""),r.style.zIndex=t,this._innerDiv.appendChild(r);var i=this._timeline.getDocument().createElement("div");return i.className="timeline-band-layer-inner",e.Platform.browser.isIE?i.style.cursor="move":i.style.cursor="-moz-grab",r.appendChild(i),i},r.prototype.removeLayerDiv=function(e){this._innerDiv.removeChild(e.parentNode)},r.prototype.scrollToCenter=function(e,t){var n=this._ether.dateToPixelOffset(e);n<-this._viewLength/2?this.setCenterVisibleDate(this.pixelOffsetToDate(n+this._viewLength)):n>3*this._viewLength/2&&this.setCenterVisibleDate(this.pixelOffsetToDate(n-this._viewLength)),this._autoScroll(Math.round(this._viewLength/2-this._ether.dateToPixelOffset(e)),t)},r.prototype.showBubbleForEvent=function(e){var t=this.getEventSource().getEvent(e);if(t){var n=this;this.scrollToCenter(t.getStart(),function(){n._eventPainter.showBubble(t)})}},r.prototype.zoom=function(e,t,n,r){if(!this._zoomSteps)return;t+=this._viewOffset;var i=this._ether.pixelOffsetToDate(t),s=this._ether.zoom(e);this._etherPainter.zoom(s),this._moveEther(Math.round(-this._ether.dateToPixelOffset(i))),this._moveEther(t)},r.prototype._onMouseDown=function(e,t,n){if(!this._dragging)return this.closeBubble(),this._dragging=!0,this._dragX=t.clientX,this._dragY=t.clientY,this._cancelEvent(t)},r.prototype._onMouseMove=function(e,t,n){if(this._dragging||this._orthogonalDragging){var r=t.clientX-this._dragX,i=t.clientY-this._dragY;this._dragX=t.clientX,this._dragY=t.clientY}if(this._dragging)this._timeline.isHorizontal()?this._moveEther(r,i):this._moveEther(i,r);else{if(!this._orthogonalDragging)return;var s=this.getViewWidth(),o=this._scrollBar.firstChild;this._timeline.isHorizontal()?this._moveEther(0,-i*s/o.offsetHeight):this._moveEther(0,-r*s/o.offsetWidth)}return this._positionHighlight(),this._showScrollbar(),this._cancelEvent(t)},r.prototype._onMouseUp=function(e,t,n){if(this._dragging)this._dragging=!1;else{if(!this._orthogonalDragging)return;this._orthogonalDragging=!1}return this._keyboardInput.focus(),this._bounceBack(),this._cancelEvent(t)},r.prototype._onMouseOut=function(e,t,n){if(n==document.body){if(this._dragging)this._dragging=!1;else{if(!this._orthogonalDragging)return;this._orthogonalDragging=!1}return this._bounceBack(),this._cancelEvent(t)}},r.prototype._onScrollBarMouseDown=function(e,t,n){if(!this._orthogonalDragging)return this.closeBubble(),this._orthogonalDragging=!0,this._dragX=t.clientX,this._dragY=t.clientY,this._cancelEvent(t)},r.prototype._onMouseScroll=function(t,n,r){var i=new Date;i=i.getTime();if(!this._lastScrollTime||i-this._lastScrollTime>50){this._lastScrollTime=i;var s=0;n.wheelDelta?s=n.wheelDelta/120:n.detail&&(s=-n.detail/3);var o=this._theme.mouseWheel;if(this._zoomSteps||o==="zoom"){var u=e.DOM.getEventRelativeCoordinates(n,t);if(s!=0){var a;s>0&&(a=!0),s<0&&(a=!1),this._timeline.zoom(a,u.x,u.y,t)}}else if(o==="scroll"){var f=50*(s<0?-1:1);this._moveEther(f)}}n.stopPropagation&&n.stopPropagation(),n.cancelBubble=!0,n.preventDefault&&n.preventDefault(),n.returnValue=!1},r.prototype._onDblClick=function(t,n,r){var i=e.DOM.getEventRelativeCoordinates(n,t),s=i.x-(this._viewLength/2-this._viewOffset);this._autoScroll(-s)},r.prototype._onKeyDown=function(t,n,r){if(!this._dragging){switch(n.keyCode){case 27:break;case 37:case 38:this._scrollSpeed=Math.min(50,Math.abs(this._scrollSpeed*1.05)),this._moveEther(this._scrollSpeed);break;case 39:case 40:this._scrollSpeed=-Math.min(50,Math.abs(this._scrollSpeed*1.05)),this._moveEther(this._scrollSpeed);break;default:return!0}return this.closeBubble(),e.DOM.cancelEvent(n),!1}return!0},r.prototype._onKeyUp=function(t,n,r){if(!this._dragging){this._scrollSpeed=this._originalScrollSpeed;switch(n.keyCode){case 35:this.setCenterVisibleDate(this._eventSource.getLatestDate());break;case 36:this.setCenterVisibleDate(this._eventSource.getEarliestDate());break;case 33:this._autoScroll(this._timeline.getPixelLength());break;case 34:this._autoScroll(-this._timeline.getPixelLength());break;default:return!0}return this.closeBubble(),e.DOM.cancelEvent(n),!1}return!0},r.prototype._autoScroll=function(t,n){var r=this,i=e.Graphics.createAnimation(function(e,t){r._moveEther(t)},0,t,1e3,n);i.run()},r.prototype._moveEther=function(e,t){t===undefined&&(t=0),this.closeBubble();if(!this._timeline.shiftOK(this._index,e))return;this._viewOffset+=e,this._ether.shiftPixels(-e),this._timeline.isHorizontal()?this._div.style.left=this._viewOffset+"px":this._div.style.top=this._viewOffset+"px",this._supportsOrthogonalScrolling&&(this._eventPainter.getOrthogonalExtent()<=this.getViewWidth()?this._viewOrthogonalOffset=0:this._viewOrthogonalOffset=this._viewOrthogonalOffset+t),this._viewOffset>-this._viewLength*.5||this._viewOffset<-this._viewLength*(r.SCROLL_MULTIPLES-1.5)?this._recenterDiv():this.softLayout(),this._onChanging()},r.prototype._onChanging=function(){this._changing=!0,this._fireOnScroll(),this._setSyncWithBandDate(),this._changing=!1},r.prototype.busy=function(){return this._changing},r.prototype._fireOnScroll=function(){for(var e=0;e<this._onScrollListeners.length;e++)this._onScrollListeners[e](this)},r.prototype._fireOnOrthogonalScroll=function(){for(var e=0;e<this._onOrthogonalScrollListeners.length;e++)this._onOrthogonalScrollListeners[e](this)},r.prototype._setSyncWithBandDate=function(){if(this._syncWithBand){var e=this._ether.pixelOffsetToDate(this.getViewLength()/2);this._syncWithBand.setCenterVisibleDate(e)}},r.prototype._onHighlightBandScroll=function(){if(this._syncWithBand){var e=this._syncWithBand.getCenterVisibleDate(),t=this._ether.dateToPixelOffset(e);this._moveEther(Math.round(this._viewLength/2-t)),this._positionHighlight()}},r.prototype._onHighlightBandOrthogonalScroll=function(){this._syncWithBand&&this._positionHighlight()},r.prototype._onAddMany=function(){this._paintEvents()},r.prototype._onClear=function(){this._paintEvents()},r.prototype._positionHighlight=function(){if(this._syncWithBand){var e=this._syncWithBand.getMinVisibleDate(),t=this._syncWithBand.getMaxVisibleDate();if(this._highlight){var n=0,r=1,i=this._syncWithBand.getEventPainter();if("supportsOrthogonalScrolling"in i&&i.supportsOrthogonalScrolling()){var s=i.getOrthogonalExtent(),o=this._syncWithBand.getViewWidth(),u=Math.max(o,s);r=o/u,n=-this._syncWithBand.getViewOrthogonalOffset()/u}this._etherPainter.setHighlight(e,t,n,r)}}},r.prototype._recenterDiv=function(){this._viewOffset=-this._viewLength*(r.SCROLL_MULTIPLES-1)/2,this._timeline.isHorizontal()?(this._div.style.left=this._viewOffset+"px",this._div.style.width=r.SCROLL_MULTIPLES*this._viewLength+"px"):(this._div.style.top=this._viewOffset+"px",this._div.style.height=r.SCROLL_MULTIPLES*this._viewLength+"px"),this.layout()},r.prototype._paintEvents=function(){this._eventPainter.paint(),this._showScrollbar(),this._fireOnOrthogonalScroll()},r.prototype._softPaintEvents=function(){this._eventPainter.softPaint()},r.prototype._paintDecorators=function(){for(var e=0;e<this._decorators.length;e++)this._decorators[e].paint()},r.prototype._softPaintDecorators=function(){for(var e=0;e<this._decorators.length;e++)this._decorators[e].softPaint()},r.prototype.closeBubble=function(){e.WindowManager.cancelPopups()},r.prototype._bounceBack=function(t){if(!this._supportsOrthogonalScrolling)return;var n=0;if(this._viewOrthogonalOffset<0){var r=this._eventPainter.getOrthogonalExtent();this._viewOrthogonalOffset+r>=this.getViewWidth()?n=this._viewOrthogonalOffset:n=Math.min(0,this.getViewWidth()-r)}if(n!=this._viewOrthogonalOffset){var i=this;e.Graphics.createAnimation(function(e,t){i._viewOrthogonalOffset=e,i._eventPainter.softPaint(),i._showScrollbar(),i._fireOnOrthogonalScroll()},this._viewOrthogonalOffset,n,300,function(){i._hideScrollbar()}).run()}else this._hideScrollbar()},r.prototype._showScrollbar=function(){if(!this._supportsOrthogonalScrolling)return;var e=this._eventPainter.getOrthogonalExtent(),t=this.getViewWidth(),n=Math.max(t,e),r=t/n,i=Math.round(t*r)+"px",s=Math.round(-this._viewOrthogonalOffset*r)+"px",o=12,u=this._scrollBar.firstChild;this._timeline.isHorizontal()?(this._scrollBar.style.top=this._div.style.top,this._scrollBar.style.height=this._div.style.height,this._scrollBar.style.right="0px",this._scrollBar.style.width=o+"px",u.style.top=s,u.style.height=i):(this._scrollBar.style.left=this._div.style.left,this._scrollBar.style.width=this._div.style.width,this._scrollBar.style.bottom="0px",this._scrollBar.style.height=o+"px",u.style.left=s,u.style.width=i),r>=1&&this._viewOrthogonalOffset==0?this._scrollBar.style.display="none":this._scrollBar.style.display="block"},r.prototype._hideScrollbar=function(){if(!this._supportsOrthogonalScrolling)return},r.prototype._cancelEvent=function(t){return e.DOM.cancelEvent(t),!1},r}),define("scripts/timeline-impl",["jquery","simile-ajax","./timeline-base","./band"],function($,SimileAjax,Timeline,Band){var TimelineImpl=function(e,t,n,r,i){SimileAjax.WindowManager.initialize(),this._containerDiv=e,this._bandInfos=t,this._orientation=n==null?Timeline.HORIZONTAL:n,this._unit=r!=null?r:SimileAjax.NativeDateUnit,this._starting=!0,this._autoResizing=!1,this.autoWidth=t&&t[0]&&t[0].theme&&t[0].theme.autoWidth,this.autoWidthAnimationTime=t&&t[0]&&t[0].theme&&t[0].theme.autoWidthAnimationTime,this.timelineID=i,this.timeline_start=t&&t[0]&&t[0].theme&&t[0].theme.timeline_start,this.timeline_stop=t&&t[0]&&t[0].theme&&t[0].theme.timeline_stop,this.timeline_at_start=!1,this.timeline_at_stop=!1,this._initialize()};return TimelineImpl.prototype.dispose=function(){for(var e=0;e<this._bands.length;e++)this._bands[e].dispose();this._bands=null,this._bandInfos=null,this._containerDiv.innerHTML="",Timeline.timelines[this.timelineID]=null},TimelineImpl.prototype.getBandCount=function(){return this._bands.length},TimelineImpl.prototype.getBand=function(e){return this._bands[e]},TimelineImpl.prototype.finishedEventLoading=function(){this._autoWidthCheck(!0),this._starting=!1},TimelineImpl.prototype.layout=function(){this._autoWidthCheck(!0),this._distributeWidths()},TimelineImpl.prototype.paint=function(){for(var e=0;e<this._bands.length;e++)this._bands[e].paint()},TimelineImpl.prototype.getDocument=function(){return this._containerDiv.ownerDocument},TimelineImpl.prototype.addDiv=function(e){this._containerDiv.appendChild(e)},TimelineImpl.prototype.removeDiv=function(e){this._containerDiv.removeChild(e)},TimelineImpl.prototype.isHorizontal=function(){return this._orientation==Timeline.HORIZONTAL},TimelineImpl.prototype.isVertical=function(){return this._orientation==Timeline.VERTICAL},TimelineImpl.prototype.getPixelLength=function(){return this._orientation==Timeline.HORIZONTAL?this._containerDiv.offsetWidth:this._containerDiv.offsetHeight},TimelineImpl.prototype.getPixelWidth=function(){return this._orientation==Timeline.VERTICAL?this._containerDiv.offsetWidth:this._containerDiv.offsetHeight},TimelineImpl.prototype.getUnit=function(){return this._unit},TimelineImpl.prototype.getWidthStyle=function(){return this._orientation==Timeline.HORIZONTAL?"height":"width"},TimelineImpl.prototype.loadXML=function(e,t){var n=this,r=function(t,r,i){alert("Failed to load data xml from "+e+"\n"+t),n.hideLoadingMessage()},i=function(r){try{var i=r.responseXML;!i.documentElement&&r.responseStream&&i.load(r.responseStream),t(i,e)}finally{n.hideLoadingMessage()}};this.showLoadingMessage(),window.setTimeout(function(){SimileAjax.XmlHttp.get(e,r,i)},0)},TimelineImpl.prototype.loadJSON=function(url,f){var tl=this,fError=function(e,t,n){alert("Failed to load json data from "+url+"\n"+e),tl.hideLoadingMessage()},fDone=function(xmlhttp){try{f(eval("("+xmlhttp.responseText+")"),url)}finally{tl.hideLoadingMessage()}};this.showLoadingMessage(),window.setTimeout(function(){SimileAjax.XmlHttp.get(url,fError,fDone)},0)},TimelineImpl.prototype._autoWidthScrollListener=function(e){e.getTimeline()._autoWidthCheck(!1)},TimelineImpl.prototype._autoWidthCheck=function(e){function i(){var e=t.getWidthStyle();if(n)t._containerDiv.style[e]=r+"px";else{t._autoResizing=!0;var i={};i[e]=r+"px",$(t._containerDiv).animate(i,t.autoWidthAnimationTime,"linear",function(){t._autoResizing=!1})}}function s(){var n=0,s=t.getPixelWidth();if(t._autoResizing)return;for(var o=0;o<t._bands.length;o++)t._bands[o].checkAutoWidth(),n+=t._bandInfos[o].width;if(n>s||e)r=n,i(),t._distributeWidths()}var t=this,n=t._starting,r=0;if(!t.autoWidth)return;s()},TimelineImpl.prototype._initialize=function(){var e=this._containerDiv,t=e.ownerDocument;e.className=e.className.split(" ").concat("timeline-container").join(" ");var n=this.isHorizontal()?"horizontal":"vertical";e.className+=" timeline-"+n;while(e.firstChild)e.removeChild(e.firstChild);var r=SimileAjax.Graphics.createTranslucentImage(Timeline.urlPrefix+(this.isHorizontal()?"images/copyright-vertical.png":"images/copyright.png"));r.className="timeline-copyright",r.title="SIMILE Timeline - http://www.simile-widgets.org/",SimileAjax.DOM.registerEvent(r,"click",function(){window.location="http://www.simile-widgets.org/"}),e.appendChild(r),this._bands=[];for(var i=0;i<this._bandInfos.length;i++){var s=new Band(this,this._bandInfos[i],i);this._bands.push(s)}this._distributeWidths();for(var i=0;i<this._bandInfos.length;i++){var o=this._bandInfos[i];"syncWith"in o&&this._bands[i].setSyncWithBand(this._bands[o.syncWith],"highlight"in o?o.highlight:!1)}if(this.autoWidth)for(var i=0;i<this._bands.length;i++)this._bands[i].addOnScrollListener(this._autoWidthScrollListener);var u=SimileAjax.Graphics.createMessageBubble(t);u.containerDiv.className="timeline-message-container",e.appendChild(u.containerDiv),u.contentDiv.className="timeline-message",u.contentDiv.innerHTML="<img src='"+Timeline.urlPrefix+"images/progress-running.gif' /> Loading...",this.showLoadingMessage=function(){u.containerDiv.style.display="block"},this.hideLoadingMessage=function(){u.containerDiv.style.display="none"}},TimelineImpl.prototype._distributeWidths=function(){var e=this.getPixelLength(),t=this.getPixelWidth(),n=0;for(var r=0;r<this._bands.length;r++){var i=this._bands[r],s=this._bandInfos[r],o=s.width,u;if(typeof o=="string"){var a=o.indexOf("%");if(a>0){var f=parseInt(o.substr(0,a));u=Math.round(f*t/100)}else u=parseInt(o)}else u=o;i.setBandShiftAndWidth(n,u),i.setViewLength(e),n+=u}},TimelineImpl.prototype.shiftOK=function(e,t){var n=t>0,r=t<0;if(n&&this.timeline_start==null||r&&this.timeline_stop==null||t==0)return!0;var i=!1;for(var s=0;s<this._bands.length&&!i;s++)i=this._bands[s].busy();if(i)return!0;if(n&&this.timeline_at_start||r&&this.timeline_at_stop)return!1;var o=!1;for(var s=0;s<this._bands.length&&!o;s++){var u=this._bands[s];n?o=(s==e?u.getMinVisibleDateAfterDelta(t):u.getMinVisibleDate())>=this.timeline_start:o=(s==e?u.getMaxVisibleDateAfterDelta(t):u.getMaxVisibleDate())<=this.timeline_stop}return n?(this.timeline_at_start=!o,this.timeline_at_stop=!1):(this.timeline_at_stop=!o,this.timeline_at_start=!1),o},TimelineImpl.prototype.zoom=function(e,t,n,r){var i=new RegExp("^timeline-band-([0-9]+)$"),s=null,o=i.exec(r.id);o&&(s=parseInt(o[1])),s!=null&&this._bands[s].zoom(e,t,n,r),this.paint()},TimelineImpl}),define("scripts/linear-ether",["simile-ajax"],function(e){var t=function(e){this._params=e,this._interval=e.interval,this._pixelsPerInterval=e.pixelsPerInterval};return t.prototype.initialize=function(e,t){this._band=e,this._timeline=t,this._unit=t.getUnit(),"startsOn"in this._params?this._start=this._unit.parseFromObject(this._params.startsOn):"endsOn"in this._params?(this._start=this._unit.parseFromObject(this._params.endsOn),this.shiftPixels(-this._timeline.getPixelLength())):"centersOn"in this._params?(this._start=this._unit.parseFromObject(this._params.centersOn),this.shiftPixels(-this._timeline.getPixelLength()/2)):(this._start=this._unit.makeDefaultValue(),this.shiftPixels(-this._timeline.getPixelLength()/2))},t.prototype.setDate=function(e){this._start=this._unit.cloneValue(e)},t.prototype.shiftPixels=function(e){var t=this._interval*e/this._pixelsPerInterval;this._start=this._unit.change(this._start,t)},t.prototype.dateToPixelOffset=function(e){var t=this._unit.compare(e,this._start);return this._pixelsPerInterval*t/this._interval},t.prototype.pixelOffsetToDate=function(e){var t=e*this._interval/this._pixelsPerInterval;return this._unit.change(this._start,t)},t.prototype.zoom=function(t){var n=0,r=this._band._zoomIndex,i=r;return t&&r>0&&(i=r-1),!t&&r<this._band._zoomSteps.length-1&&(i=r+1),this._band._zoomIndex=i,this._interval=e.DateTime.gregorianUnitLengths[this._band._zoomSteps[i].unit],this._pixelsPerInterval=this._band._zoomSteps[i].pixelsPerInterval,n=this._band._zoomSteps[i].unit-this._band._zoomSteps[r].unit,n},t}),define("scripts/ether-interval-marker-layout",["simile-ajax"],function(e){var t=function(t,n,r,i,s){var o=t.isHorizontal();o?i=="Top"?this.positionDiv=function(e,t){e.style.left=t+"px",e.style.top="0px"}:this.positionDiv=function(e,t){e.style.left=t+"px",e.style.bottom="0px"}:i=="Left"?this.positionDiv=function(e,t){e.style.top=t+"px",e.style.left="0px"}:this.positionDiv=function(e,t){e.style.top=t+"px",e.style.right="0px"};var u=r.ether.interval.marker,a=r.ether.interval.line,f=r.ether.interval.weekend,l=(o?"h":"v")+i,c=u[l+"Styler"],h=u[l+"EmphasizedStyler"],p=e.DateTime.gregorianUnitLengths[e.DateTime.DAY];this.createIntervalMarker=function(i,u,l,c,h){var d=Math.round(n.dateToPixelOffset(i));if(s&&l!=e.DateTime.WEEK){var v=t.getDocument().createElement("div");v.className="timeline-ether-lines",a.opacity<100&&e.Graphics.setOpacity(v,a.opacity),o?v.style.left=d+"px":v.style.top=d+"px",h.appendChild(v)}if(l==e.DateTime.WEEK){var m=r.firstDayOfWeek,g=new Date(i.getTime()+(6-m-7)*p),y=new Date(g.getTime()+2*p),b=Math.round(n.dateToPixelOffset(g)),w=Math.round(n.dateToPixelOffset(y)),E=Math.max(1,w-b),S=t.getDocument().createElement("div");S.className="timeline-ether-weekends",f.opacity<100&&e.Graphics.setOpacity(S,f.opacity),o?(S.style.left=b+"px",S.style.width=E+"px"):(S.style.top=b+"px",S.style.height=E+"px"),h.appendChild(S)}var x=u.labelInterval(i,l),T=t.getDocument().createElement("div");return T.innerHTML=x.text,T.className="timeline-date-label",x.emphasized&&(T.className+=" timeline-date-label-em"),this.positionDiv(T,d),c.appendChild(T),T}};return t}),define("scripts/ether-highlight",["simile-ajax"],function(e){var t=function(t,n,r,i){var s=t.isHorizontal();this._highlightDiv=null,this._createHighlightDiv=function(){if(this._highlightDiv==null){this._highlightDiv=t.getDocument().createElement("div"),this._highlightDiv.setAttribute("name","ether-highlight"),this._highlightDiv.className="timeline-ether-highlight";var n=r.ether.highlightOpacity;n<100&&e.Graphics.setOpacity(this._highlightDiv,n),i.appendChild(this._highlightDiv)}},this.position=function(e,t,r,i){r=r||0,i=i||1,this._createHighlightDiv();var o=Math.round(n.dateToPixelOffset(e)),u=Math.round(n.dateToPixelOffset(t)),a=Math.max(u-o,3),f=n.getViewWidth()-4;s?(this._highlightDiv.style.left=o+"px",this._highlightDiv.style.width=a+"px",this._highlightDiv.style.top=Math.round(r*f)+"px",this._highlightDiv.style.height=Math.round(i*f)+"px"):(this._highlightDiv.style.top=o+"px",this._highlightDiv.style.height=a+"px",this._highlightDiv.style.left=Math.round(r*f)+"px",this._highlightDiv.style.width=Math.round(i*f)+"px")}};return t}),define("scripts/gregorian-ether-painter",["simile-ajax","./ether-interval-marker-layout","./ether-highlight"],function(e,t,n){var r=function(e){this._params=e,this._theme=e.theme,this._unit=e.unit,this._multiple="multiple"in e?e.multiple:1};return r.prototype.initialize=function(e,r){this._band=e,this._timeline=r,this._backgroundLayer=e.createLayerDiv(0),this._backgroundLayer.setAttribute("name","ether-background"),this._backgroundLayer.className="timeline-ether-bg",this._markerLayer=null,this._lineLayer=null;var i="align"in this._params&&this._params.align!=undefined?this._params.align:this._theme.ether.interval.marker[r.isHorizontal()?"hAlign":"vAlign"],s="showLine"in this._params?this._params.showLine:this._theme.ether.interval.line.show;this._intervalMarkerLayout=new t(this._timeline,this._band,this._theme,i,s),this._highlight=new n(this._timeline,this._band,this._theme,this._backgroundLayer)},r.prototype.setHighlight=function(e,t,n,r){this._highlight.position(e,t,n,r)},r.prototype.paint=function(){this._markerLayer&&this._band.removeLayerDiv(this._markerLayer),this._markerLayer=this._band.createLayerDiv(100),this._markerLayer.setAttribute("name","ether-markers"),this._markerLayer.style.display="none",this._lineLayer&&this._band.removeLayerDiv(this._lineLayer),this._lineLayer=this._band.createLayerDiv(1),this._lineLayer.setAttribute("name","ether-lines"),this._lineLayer.style.display="none";var t=this._band.getMinDate(),n=this._band.getMaxDate(),r=this._band.getTimeZone(),i=this._band.getLabeller();e.DateTime.roundDownToInterval(t,this._unit,r,this._multiple,this._theme.firstDayOfWeek);var s=this,o=function(t){for(var n=0;n<s._multiple;n++)e.DateTime.incrementByInterval(t,s._unit)};while(t.getTime()<n.getTime())this._intervalMarkerLayout.createIntervalMarker(t,i,this._unit,this._markerLayer,this._lineLayer),o(t);this._markerLayer.style.display="block",this._lineLayer.style.display="block"},r.prototype.softPaint=function(){},r.prototype.zoom=function(e){e!=0&&(this._unit+=e)},r}),define("scripts/hot-zone-gregorian-ether-painter",["simile-ajax","./ether-interval-marker-layout","./ether-highlight"],function(e,t,n){var r=function(t){this._params=t,this._theme=t.theme,this._zones=[{startTime:Number.NEGATIVE_INFINITY,endTime:Number.POSITIVE_INFINITY,unit:t.unit,multiple:1}];for(var n=0;n<t.zones.length;n++){var r=t.zones[n],i=e.DateTime.parseGregorianDateTime(r.start).getTime(),s=e.DateTime.parseGregorianDateTime(r.end).getTime();for(var o=0;o<this._zones.length&&s>i;o++){var u=this._zones[o];i<u.endTime&&(i>u.startTime&&(this._zones.splice(o,0,{startTime:u.startTime,endTime:i,unit:u.unit,multiple:u.multiple}),o++,u.startTime=i),s<u.endTime?(this._zones.splice(o,0,{startTime:i,endTime:s,unit:r.unit,multiple:r.multiple?r.multiple:1}),o++,u.startTime=s,i=s):(u.multiple=r.multiple,u.unit=r.unit,i=u.endTime))}}};return r.prototype.initialize=function(e,r){this._band=e,this._timeline=r,this._backgroundLayer=e.createLayerDiv(0),this._backgroundLayer.setAttribute("name","ether-background"),this._backgroundLayer.className="timeline-ether-bg",this._markerLayer=null,this._lineLayer=null;var i="align"in this._params&&this._params.align!=undefined?this._params.align:this._theme.ether.interval.marker[r.isHorizontal()?"hAlign":"vAlign"],s="showLine"in this._params?this._params.showLine:this._theme.ether.interval.line.show;this._intervalMarkerLayout=new t(this._timeline,this._band,this._theme,i,s),this._highlight=new n(this._timeline,this._band,this._theme,this._backgroundLayer)},r.prototype.setHighlight=function(e,t){this._highlight.position(e,t)},r.prototype.paint=function(){this._markerLayer&&this._band.removeLayerDiv(this._markerLayer),this._markerLayer=this._band.createLayerDiv(100),this._markerLayer.setAttribute("name","ether-markers"),this._markerLayer.style.display="none",this._lineLayer&&this._band.removeLayerDiv(this._lineLayer),this._lineLayer=this._band.createLayerDiv(1),this._lineLayer.setAttribute("name","ether-lines"),this._lineLayer.style.display="none";var t=this._band.getMinDate(),n=this._band.getMaxDate(),r=this._band.getTimeZone(),i=this._band.getLabeller(),s=this,o=function(t,n){for(var r=0;r<n.multiple;r++)e.DateTime.incrementByInterval(t,n.unit)},u=0;while(u<this._zones.length){if(t.getTime()<this._zones[u].endTime)break;u++}var a=this._zones.length-1;while(a>=0){if(n.getTime()>this._zones[a].startTime)break;a--}for(var f=u;f<=a;f++){var l=this._zones[f],c=new Date(Math.max(t.getTime(),l.startTime)),h=new Date(Math.min(n.getTime(),l.endTime));e.DateTime.roundDownToInterval(c,l.unit,r,l.multiple,this._theme.firstDayOfWeek),e.DateTime.roundUpToInterval(h,l.unit,r,l.multiple,this._theme.firstDayOfWeek);while(c.getTime()<h.getTime())this._intervalMarkerLayout.createIntervalMarker(c,i,l.unit,this._markerLayer,this._lineLayer),o(c,l)}this._markerLayer.style.display="block",this._lineLayer.style.display="block"},r.prototype.softPaint=function(){},r.prototype.zoom=function(e){if(e!=0)for(var t=0;t<this._zones.length;++t)this._zones[t]&&(this._zones[t].unit+=e)},r}),define("scripts/overview-painter",["simile-ajax"],function(e){var t=function(e){this._params=e,this._onSelectListeners=[],this._filterMatcher=null,this._highlightMatcher=null};return t.prototype.initialize=function(e,t){this._band=e,this._timeline=t,this._eventLayer=null,this._highlightLayer=null},t.prototype.getType=function(){return"overview"},t.prototype.addOnSelectListener=function(e){this._onSelectListeners.push(e)},t.prototype.removeOnSelectListener=function(e){for(var t=0;t<this._onSelectListeners.length;t++)if(this._onSelectListeners[t]==e){this._onSelectListeners.splice(t,1);break}},t.prototype.getFilterMatcher=function(){return this._filterMatcher},t.prototype.setFilterMatcher=function(e){this._filterMatcher=e},t.prototype.getHighlightMatcher=function(){return this._highlightMatcher},t.prototype.setHighlightMatcher=function(e){this._highlightMatcher=e},t.prototype.paint=function(){var e=this._band.getEventSource();if(e==null)return;this._prepareForPainting();var t=this._params.theme.event,n={trackOffset:t.overviewTrack.offset,trackHeight:t.overviewTrack.height,trackGap:t.overviewTrack.gap,trackIncrement:t.overviewTrack.height+t.overviewTrack.gap},r=this._band.getMinDate(),i=this._band.getMaxDate(),s=this._filterMatcher!=null?this._filterMatcher:function(e){return!0},o=this._highlightMatcher!=null?this._highlightMatcher:function(e){return-1},u=e.getEventReverseIterator(r,i);while(u.hasNext()){var a=u.next();s(a)&&this.paintEvent(a,n,this._params.theme,o(a))}this._highlightLayer.style.display="block",this._eventLayer.style.display="block",this._band.updateEventTrackInfo(this._tracks.length,n.trackIncrement)},t.prototype.softPaint=function(){},t.prototype._prepareForPainting=function(){var e=this._band;this._tracks=[],this._highlightLayer!=null&&e.removeLayerDiv(this._highlightLayer),this._highlightLayer=e.createLayerDiv(105,"timeline-band-highlights"),this._highlightLayer.style.display="none",this._eventLayer!=null&&e.removeLayerDiv(this._eventLayer),this._eventLayer=e.createLayerDiv(110,"timeline-band-events"),this._eventLayer.style.display="none"},t.prototype.paintEvent=function(e,t,n,r){e.isInstant()?this.paintInstantEvent(e,t,n,r):this.paintDurationEvent(e,t,n,r)},t.prototype.paintInstantEvent=function(e,t,n,r){var i=e.getStart(),s=Math.round(this._band.dateToPixelOffset(i)),o=e.getColor(),u=e.getClassName();u?o=null:o=o!=null?o:n.event.duration.color;var a=this._paintEventTick(e,s,o,100,t,n);this._createHighlightDiv(r,a,n)},t.prototype.paintDurationEvent=function(e,t,n,r){var i=e.getLatestStart(),s=e.getEarliestEnd(),o=Math.round(this._band.dateToPixelOffset(i)),u=Math.round(this._band.dateToPixelOffset(s)),a=0;for(;a<this._tracks.length;a++)if(u<this._tracks[a])break;this._tracks[a]=u;var f=e.getColor(),l=e.getClassName();l?f=null:f=f!=null?f:n.event.duration.color;var c=this._paintEventTape(e,a,o,u,f,100,t,n,l);this._createHighlightDiv(r,c,n)},t.prototype._paintEventTape=function(t,n,r,i,s,o,u,a,f){var l=u.trackOffset+n*u.trackIncrement,c=i-r,h=u.trackHeight,p=this._timeline.getDocument().createElement("div");return p.className="timeline-small-event-tape",f&&(p.className+=" small-"+f),p.style.left=r+"px",p.style.width=c+"px",p.style.top=l+"px",p.style.height=h+"px",s&&(p.style.backgroundColor=s),o<100&&e.Graphics.setOpacity(p,o),this._eventLayer.appendChild(p),{left:r,top:l,width:c,height:h,elmt:p}},t.prototype._paintEventTick=function(t,n,r,i,s,o){var u=o.event.overviewTrack.tickHeight,a=s.trackOffset-u,f=1,l=this._timeline.getDocument().createElement("div");l.className="timeline-small-event-icon",l.style.left=n+"px",l.style.top=a+"px";var c=t.getClassName();return c&&(l.className+=" small-"+c),i<100&&e.Graphics.setOpacity(l,i),this._eventLayer.appendChild(l),{left:n,top:a,width:f,height:u,elmt:l}},t.prototype._createHighlightDiv=function(e,t,n){if(e>=0){var r=this._timeline.getDocument(),i=n.event,s=i.highlightColors[Math.min(e,i.highlightColors.length-1)],o=r.createElement("div");o.style.position="absolute",o.style.overflow="hidden",o.style.left=t.left-1+"px",o.style.width=t.width+2+"px",o.style.top=t.top-1+"px",o.style.height=t.height+2+"px",o.style.background=s,this._highlightLayer.appendChild(o)}},t.prototype.showBubble=function(e){},t}),define("scripts/detailed-painter",["simile-ajax"],function(e){var t=function(e){this._params=e,this._onSelectListeners=[],this._filterMatcher=null,this._highlightMatcher=null,this._frc=null,this._eventIdToElmt={}};return t.prototype.initialize=function(e,t){this._band=e,this._timeline=t,this._backLayer=null,this._eventLayer=null,this._lineLayer=null,this._highlightLayer=null,this._eventIdToElmt=null},t.prototype.getType=function(){return"detailed"},t.prototype.addOnSelectListener=function(e){this._onSelectListeners.push(e)},t.prototype.removeOnSelectListener=function(e){for(var t=0;t<this._onSelectListeners.length;t++)if(this._onSelectListeners[t]==e){this._onSelectListeners.splice(t,1);break}},t.prototype.getFilterMatcher=function(){return this._filterMatcher},t.prototype.setFilterMatcher=function(e){this._filterMatcher=e},t.prototype.getHighlightMatcher=function(){return this._highlightMatcher},t.prototype.setHighlightMatcher=function(e){this._highlightMatcher=e},t.prototype.paint=function(){var e=this._band.getEventSource();if(e==null)return;this._eventIdToElmt={},this._prepareForPainting();var t=this._params.theme.event,n=Math.max(t.track.height,this._frc.getLineHeight()),r={trackOffset:Math.round(this._band.getViewWidth()/2-n/2),trackHeight:n,trackGap:t.track.gap,trackIncrement:n+t.track.gap,icon:t.instant.icon,iconWidth:t.instant.iconWidth,iconHeight:t.instant.iconHeight,labelWidth:t.label.width},i=this._band.getMinDate(),s=this._band.getMaxDate(),o=this._filterMatcher!=null?this._filterMatcher:function(e){return!0},u=this._highlightMatcher!=null?this._highlightMatcher:function(e){return-1},a=e.getEventReverseIterator(i,s);while(a.hasNext()){var f=a.next();o(f)&&this.paintEvent(f,r,this._params.theme,u(f))}this._highlightLayer.style.display="block",this._lineLayer.style.display="block",this._eventLayer.style.display="block",this._band.updateEventTrackInfo(this._lowerTracks.length+this._upperTracks.length,r.trackIncrement)},t.prototype.softPaint=function(){},t.prototype._prepareForPainting=function(){var t=this._band;if(this._backLayer==null){this._backLayer=this._band.createLayerDiv(0,"timeline-band-events"),this._backLayer.style.visibility="hidden";var n=document.createElement("span");n.className="timeline-event-label",this._backLayer.appendChild(n),this._frc=e.Graphics.getFontRenderingContext(n)}this._frc.update(),this._lowerTracks=[],this._upperTracks=[],this._highlightLayer!=null&&t.removeLayerDiv(this._highlightLayer),this._highlightLayer=t.createLayerDiv(105,"timeline-band-highlights"),this._highlightLayer.style.display="none",this._lineLayer!=null&&t.removeLayerDiv(this._lineLayer),this._lineLayer=t.createLayerDiv(110,"timeline-band-lines"),this._lineLayer.style.display="none",this._eventLayer!=null&&t.removeLayerDiv(this._eventLayer),this._eventLayer=t.createLayerDiv(110,"timeline-band-events"),this._eventLayer.style.display="none"},t.prototype.paintEvent=function(e,t,n,r){e.isInstant()?this.paintInstantEvent(e,t,n,r):this.paintDurationEvent(e,t,n,r)},t.prototype.paintInstantEvent=function(e,t,n,r){e.isImprecise()?this.paintImpreciseInstantEvent(e,t,n,r):this.paintPreciseInstantEvent(e,t,n,r)},t.prototype.paintDurationEvent=function(e,t,n,r){e.isImprecise()?this.paintImpreciseDurationEvent(e,t,n,r):this.paintPreciseDurationEvent(e,t,n,r)},t.prototype.paintPreciseInstantEvent=function(t,n,r,i){var s=this._timeline.getDocument(),o=t.getText(),u=t.getStart(),a=Math.round(this._band.dateToPixelOffset(u)),f=Math.round(a+n.iconWidth/2),l=Math.round(a-n.iconWidth/2),c=this._frc.computeSize(o),h=this._findFreeTrackForSolid(f,a),p=this._paintEventIcon(t,h,l,n,r),d=f+r.event.label.offsetFromLine,v=h,m=this._getTrackData(h);Math.min(m.solid,m.text)>=d+c.width?(m.solid=l,m.text=d):(m.solid=l,d=a+r.event.label.offsetFromLine,v=this._findFreeTrackForText(h,d+c.width,function(e){e.line=a-2}),this._getTrackData(v).text=l,this._paintEventLine(t,a,h,v,n,r));var g=Math.round(n.trackOffset+v*n.trackIncrement+n.trackHeight/2-c.height/2),y=this._paintEventLabel(t,o,d,g,c.width,c.height,r),b=this,w=function(e,n,r){return b._onClickInstantEvent(p.elmt,n,t)};e.DOM.registerEvent(p.elmt,"mousedown",w),e.DOM.registerEvent(y.elmt,"mousedown",w),this._createHighlightDiv(i,p,r),this._eventIdToElmt[t.getID()]=p.elmt},t.prototype.paintImpreciseInstantEvent=function(t,n,r,i){var s=this._timeline.getDocument(),o=t.getText(),u=t.getStart(),a=t.getEnd(),f=Math.round(this._band.dateToPixelOffset(u)),l=Math.round(this._band.dateToPixelOffset(a)),c=Math.round(f+n.iconWidth/2),h=Math.round(f-n.iconWidth/2),p=this._frc.computeSize(o),d=this._findFreeTrackForSolid(l,f),v=this._paintEventTape(t,d,f,l,r.event.instant.impreciseColor,r.event.instant.impreciseOpacity,n,r),m=this._paintEventIcon(t,d,h,n,r),g=this._getTrackData(d);g.solid=h;var y=c+r.event.label.offsetFromLine,b=y+p.width,w;b<l?w=d:(y=f+r.event.label.offsetFromLine,b=y+p.width,w=this._findFreeTrackForText(d,b,function(e){e.line=f-2}),this._getTrackData(w).text=h,this._paintEventLine(t,f,d,w,n,r));var E=Math.round(n.trackOffset+w*n.trackIncrement+n.trackHeight/2-p.height/2),S=this._paintEventLabel(t,o,y,E,p.width,p.height,r),x=this,T=function(e,n,r){return x._onClickInstantEvent(m.elmt,n,t)};e.DOM.registerEvent(m.elmt,"mousedown",T),e.DOM.registerEvent(v.elmt,"mousedown",T),e.DOM.registerEvent(S.elmt,"mousedown",T),this._createHighlightDiv(i,m,r),this._eventIdToElmt[t.getID()]=m.elmt},t.prototype.paintPreciseDurationEvent=function(t,n,r,i){var s=this._timeline.getDocument(),o=t.getText(),u=t.getStart(),a=t.getEnd(),f=Math.round(this._band.dateToPixelOffset(u)),l=Math.round(this._band.dateToPixelOffset(a)),c=this._frc.computeSize(o),h=this._findFreeTrackForSolid(l),p=t.getColor();p=p!=null?p:r.event.duration.color;var d=this._paintEventTape(t,h,f,l,p,100,n,r),v=this._getTrackData(h);v.solid=f;var m=f+r.event.label.offsetFromLine,g=this._findFreeTrackForText(h,m+c.width,function(e){e.line=f-2});this._getTrackData(g).text=f-2,this._paintEventLine(t,f,h,g,n,r);var y=Math.round(n.trackOffset+g*n.trackIncrement+n.trackHeight/2-c.height/2),b=this._paintEventLabel(t,o,m,y,c.width,c.height,r),w=this,E=function(e,n,r){return w._onClickDurationEvent(d.elmt,n,t)};e.DOM.registerEvent(d.elmt,"mousedown",E),e.DOM.registerEvent(b.elmt,"mousedown",E),this._createHighlightDiv(i,d,r),this._eventIdToElmt[t.getID()]=d.elmt},t.prototype.paintImpreciseDurationEvent=function(t,n,r,i){var s=this._timeline.getDocument(),o=t.getText(),u=t.getStart(),a=t.getLatestStart(),f=t.getEnd(),l=t.getEarliestEnd(),c=Math.round(this._band.dateToPixelOffset(u)),h=Math.round(this._band.dateToPixelOffset(a)),p=Math.round(this._band.dateToPixelOffset(f)),d=Math.round(this._band.dateToPixelOffset(l)),v=this._frc.computeSize(o),m=this._findFreeTrackForSolid(p),g=t.getColor();g=g!=null?g:r.event.duration.color;var y=this._paintEventTape(t,m,c,p,r.event.duration.impreciseColor,r.event.duration.impreciseOpacity,n,r),b=this._paintEventTape(t,m,h,d,g,100,n,r),w=this._getTrackData(m);w.solid=c;var E=h+r.event.label.offsetFromLine,S=this._findFreeTrackForText(m,E+v.width,function(e){e.line=h-2});this._getTrackData(S).text=h-2,this._paintEventLine(t,h,m,S,n,r);var x=Math.round(n.trackOffset+S*n.trackIncrement+n.trackHeight/2-v.height/2),T=this._paintEventLabel(t,o,E,x,v.width,v.height,r),N=this,C=function(e,n,r){return N._onClickDurationEvent(b.elmt,n,t)};e.DOM.registerEvent(b.elmt,"mousedown",C),e.DOM.registerEvent(T.elmt,"mousedown",C),this._createHighlightDiv(i,b,r),this._eventIdToElmt[t.getID()]=b.elmt},t.prototype._findFreeTrackForSolid=function(e,t){for(var n=0;!0;n++){if(!(n<this._lowerTracks.length))return this._lowerTracks.push({solid:Number.POSITIVE_INFINITY,text:Number.POSITIVE_INFINITY,line:Number.POSITIVE_INFINITY}),n;var r=this._lowerTracks[n];if(Math.min(r.solid,r.text)>e&&(!t||r.line>t))return n;if(!(n<this._upperTracks.length))return this._upperTracks.push({solid:Number.POSITIVE_INFINITY,text:Number.POSITIVE_INFINITY,line:Number.POSITIVE_INFINITY}),-1-n;var r=this._upperTracks[n];if(Math.min(r.solid,r.text)>e&&(!t||r.line>t))return-1-n}},t.prototype._findFreeTrackForText=function(e,t,n){var r,i,s,o;if(e<0)r=!0,s=-e,i=this._findFreeUpperTrackForText(s,t),o=-1-i;else if(e>0)r=!1,s=e+1,i=this._findFreeLowerTrackForText(s,t),o=i;else{var u=this._findFreeUpperTrackForText(0,t),a=this._findFreeLowerTrackForText(1,t);a-1<=u?(r=!1,s=1,i=a,o=i):(r=!0,s=0,i=u,o=-1-i)}if(r){i==this._upperTracks.length&&this._upperTracks.push({solid:Number.POSITIVE_INFINITY,text:Number.POSITIVE_INFINITY,line:Number.POSITIVE_INFINITY});for(var f=s;f<i;f++)n(this._upperTracks[f])}else{i==this._lowerTracks.length&&this._lowerTracks.push({solid:Number.POSITIVE_INFINITY,text:Number.POSITIVE_INFINITY,line:Number.POSITIVE_INFINITY});for(var f=s;f<i;f++)n(this._lowerTracks[f])}return o},t.prototype._findFreeLowerTrackForText=function(e,t){for(;e<this._lowerTracks.length;e++){var n=this._lowerTracks[e];if(Math.min(n.solid,n.text)>=t)break}return e},t.prototype._findFreeUpperTrackForText=function(e,t){for(;e<this._upperTracks.length;e++){var n=this._upperTracks[e];if(Math.min(n.solid,n.text)>=t)break}return e},t.prototype._getTrackData=function(e){return e<0?this._upperTracks[-e-1]:this._lowerTracks[e]},t.prototype._paintEventLine=function(e,t,n,r,i,s){var o=Math.round(i.trackOffset+n*i.trackIncrement+i.trackHeight/2),u=Math.round(Math.abs(r-n)*i.trackIncrement),a="1px solid "+s.event.label.lineColor,f=this._timeline.getDocument().createElement("div");f.style.position="absolute",f.style.left=t+"px",f.style.width=s.event.label.offsetFromLine+"px",f.style.height=u+"px",n>r?(f.style.top=o-u+"px",f.style.borderTop=a):(f.style.top=o+"px",f.style.borderBottom=a),f.style.borderLeft=a,this._lineLayer.appendChild(f)},t.prototype._paintEventIcon=function(t,n,r,i,s){var o=t.getIcon();o=o!=null?o:i.icon;var u=i.trackOffset+n*i.trackIncrement+i.trackHeight/2,a=Math.round(u-i.iconHeight/2),f=e.Graphics.createTranslucentImage(o),l=this._timeline.getDocument().createElement("div");return l.style.position="absolute",l.style.left=r+"px",l.style.top=a+"px",l.appendChild(f),l.style.cursor="pointer",t._title!=null&&(l.title=t._title),this._eventLayer.appendChild(l),{left:r,top:a,width:i.iconWidth,height:i.iconHeight,elmt:l}},t.prototype._paintEventLabel=function(t,n,r,i,s,o,u){var a=this._timeline.getDocument(),f=a.createElement("div");f.style.position="absolute",f.style.left=r+"px",f.style.width=s+"px",f.style.top=i+"px",f.style.height=o+"px",f.style.backgroundColor=u.event.label.backgroundColor,e.Graphics.setOpacity(f,u.event.label.backgroundOpacity),this._eventLayer.appendChild(f);var l=a.createElement("div");l.style.position="absolute",l.style.left=r+"px",l.style.width=s+"px",l.style.top=i+"px",l.innerHTML=n,l.style.cursor="pointer",t._title!=null&&(l.title=t._title);var c=t.getTextColor();return c==null&&(c=t.getColor()),c!=null&&(l.style.color=c),this._eventLayer.appendChild(l),{left:r,top:i,width:s,height:o,elmt:l}},t.prototype._paintEventTape=function(t,n,r,i,s,o,u,a){var f=i-r,l=a.event.tape.height,c=u.trackOffset+n*u.trackIncrement+u.trackHeight/2,h=Math.round(c-l/2),p=this._timeline.getDocument().createElement("div");return p.style.position="absolute",p.style.left=r+"px",p.style.width=f+"px",p.style.top=h+"px",p.style.height=l+"px",p.style.backgroundColor=s,p.style.overflow="hidden",p.style.cursor="pointer",t._title!=null&&(p.title=t._title),e.Graphics.setOpacity(p,o),this._eventLayer.appendChild(p),{left:r,top:h,width:f,height:l,elmt:p}},t.prototype._createHighlightDiv=function(e,t,n){if(e>=0){var r=this._timeline.getDocument(),i=n.event,s=i.highlightColors[Math.min(e,i.highlightColors.length-1)],o=r.createElement("div");o.style.position="absolute",o.style.overflow="hidden",o.style.left=t.left-2+"px",o.style.width=t.width+4+"px",o.style.top=t.top-2+"px",o.style.height=t.height+4+"px",o.style.background=s,this._highlightLayer.appendChild(o)}},t.prototype._onClickInstantEvent=function(t,n,r){var i=e.DOM.getPageCoordinates(t);return this._showBubble(i.left+Math.ceil(t.offsetWidth/2),i.top+Math.ceil(t.offsetHeight/2),r),this._fireOnSelect(r.getID()),n.cancelBubble=!0,e.DOM.cancelEvent(n),!1},t.prototype._onClickDurationEvent=function(t,n,r){if("pageX"in n)var i=n.pageX,s=n.pageY;else var o=e.DOM.getPageCoordinates(t),i=n.offsetX+o.left,s=n.offsetY+o.top;return this._showBubble(i,s,r),this._fireOnSelect(r.getID()),n.cancelBubble=!0,e.DOM.cancelEvent(n),!1},t.prototype.showBubble=function(t){var n=this._eventIdToElmt[t.getID()];if(n){var r=e.DOM.getPageCoordinates(n);this._showBubble(r.left+n.offsetWidth/2,r.top+n.offsetHeight/2,t)}},t.prototype._showBubble=function(t,n,r){var i=document.createElement("div"),s=this._params.theme.event.bubble;r.fillInfoBubble(i,this._params.theme,this._band.getLabeller()),e.WindowManager.cancelPopups(),e.Graphics.createBubbleForContentAndPoint(i,t,n,s.width,null,s.maxHeight)},t.prototype._fireOnSelect=function(e){for(var t=0;t<this._onSelectListeners.length;t++)this._onSelectListeners[t](e)},t}),define("scripts/event-utils",["./timeline-base"],function(e){var t={};return t.getNewEventID=function(){return this._lastEventID==null&&(this._lastEventID=0),this._lastEventID+=1,"e"+this._lastEventID},t.decodeEventElID=function(t){var n=t.split("-");if(n[1]!="tl")return alert("Internal Timeline problem 101, please consult support"),{band:null,evt:null};var r=e.getTimelineFromID(n[2]),i=r.getBand(n[3]),s=i.getEventSource.getEvent(n[4]);return{band:i,evt:s}},t.encodeEventElID=function(e,t,n,r){return n+"-tl-"+e.timelineID+"-"+t.getIndex()+"-"+r.getID()},t}),define("scripts/original-painter",["simile-ajax","./event-utils"],function(e,t){var n=function(e){this._params=e,this._onSelectListeners=[],this._eventPaintListeners=[],this._tracks=[],this._filterMatcher=null,this._highlightMatcher=null,this._frc=null,this._eventIdToElmt={}};return n.prototype.initialize=function(t,n){this._band=t,this._timeline=n,this._backLayer=null,this._eventLayer=null,this._lineLayer=null,this._highlightLayer=null,this._eventIdToElmt=null;if(this._backLayer==null){this._backLayer=this._band.createLayerDiv(0,"timeline-band-events"),this._backLayer.style.visibility="hidden";var r=document.createElement("span");r.className="timeline-event-label",this._backLayer.appendChild(r),this._frc=e.Graphics.getFontRenderingContext(r)}this._frc.update()},n.prototype.getType=function(){return"original"},n.prototype.supportsOrthogonalScrolling=function(){return!0},n.prototype.addOnSelectListener=function(e){this._onSelectListeners.push(e)},n.prototype.removeOnSelectListener=function(e){for(var t=0;t<this._onSelectListeners.length;t++)if(this._onSelectListeners[t]==e){this._onSelectListeners.splice(t,1);break}},n.prototype.addEventPaintListener=function(e){this._eventPaintListeners.push(e)},n.prototype.removeEventPaintListener=function(e){for(var t=0;t<this._eventPaintListeners.length;t++)if(this._eventPaintListeners[t]==e){this._eventPaintListeners.splice(t,1);break}},n.prototype.getFilterMatcher=function(){return this._filterMatcher},n.prototype.setFilterMatcher=function(e){this._filterMatcher=e},n.prototype.getHighlightMatcher=function(){return this._highlightMatcher},n.prototype.setHighlightMatcher=function(e){this._highlightMatcher=e},n.prototype.paint=function(){var e=this._band.getEventSource();if(e==null)return;this._eventIdToElmt={},this._fireEventPaintListeners("paintStarting",null,null),this._prepareForPainting();var t=this._computeMetrics(),n=this._band.getMinDate(),r=this._band.getMaxDate(),i=this._filterMatcher!=null?this._filterMatcher:function(e){return!0},s=this._highlightMatcher!=null?this._highlightMatcher:function(e){return-1},o=e.getEventReverseIterator(n,r);while(o.hasNext()){var u=o.next();i(u)&&this.paintEvent(u,t,this._params.theme,s(u))}this._highlightLayer.style.display="block",this._lineLayer.style.display="block",this._eventLayer.style.display="block",this._band.updateEventTrackInfo(this._tracks.length,t.trackIncrement),this._fireEventPaintListeners("paintEnded",null,null),this._setOrthogonalOffset(t)},n.prototype.softPaint=function(){this._setOrthogonalOffset(this._computeMetrics())},n.prototype.getOrthogonalExtent=function(){var e=this._computeMetrics();return 2*e.trackOffset+this._tracks.length*e.trackIncrement},n.prototype._setOrthogonalOffset=function(e){var t=this._band.getViewOrthogonalOffset(),n=["_highlightLayer","_lineLayer","_eventLayer"],r,i;for(r=0;r<n.length;r++)i=this[n[r]],i!==null&&(i.style.top=t+"px")},n.prototype._computeMetrics=function(){var e=this._params.theme.event,t=Math.max(e.track.height,e.tape.height+this._frc.getLineHeight()),n={trackOffset:e.track.offset,trackHeight:t,trackGap:e.track.gap,trackIncrement:t+e.track.gap,icon:e.instant.icon,iconWidth:e.instant.iconWidth,iconHeight:e.instant.iconHeight,labelWidth:e.label.width,maxLabelChar:e.label.maxLabelChar,impreciseIconMargin:e.instant.impreciseIconMargin};return n},n.prototype._prepareForPainting=function(){var e=this._band;this._tracks=[],this._highlightLayer!=null&&e.removeLayerDiv(this._highlightLayer),this._highlightLayer=e.createLayerDiv(105,"timeline-band-highlights"),this._highlightLayer.style.display="none",this._lineLayer!=null&&e.removeLayerDiv(this._lineLayer),this._lineLayer=e.createLayerDiv(110,"timeline-band-lines"),this._lineLayer.style.display="none",this._eventLayer!=null&&e.removeLayerDiv(this._eventLayer),this._eventLayer=e.createLayerDiv(115,"timeline-band-events"),this._eventLayer.style.display="none"},n.prototype.paintEvent=function(e,t,n,r){e.isInstant()?this.paintInstantEvent(e,t,n,r):this.paintDurationEvent(e,t,n,r)},n.prototype.paintInstantEvent=function(e,t,n,r){e.isImprecise()?this.paintImpreciseInstantEvent(e,t,n,r):this.paintPreciseInstantEvent(e,t,n,r)},n.prototype.paintDurationEvent=function(e,t,n,r){e.isImprecise()?this.paintImpreciseDurationEvent(e,t,n,r):this.paintPreciseDurationEvent(e,t,n,r)},n.prototype.paintPreciseInstantEvent=function(t,n,r,i){var s=this._timeline.getDocument(),o=t.getText(),u=t.getStart(),a=Math.round(this._band.dateToPixelOffset(u)),f=Math.round(a+n.iconWidth/2),l=Math.round(a-n.iconWidth/2),c=this._getLabelDivClassName(t),h=this._frc.computeSize(o,c),p=f+r.event.label.offsetFromLine,d=p+h.width,v=d,m=this._findFreeTrack(t,v),g=Math.round(n.trackOffset+m*n.trackIncrement+n.trackHeight/2-h.height/2),y=this._paintEventIcon(t,m,l,n,r,0),b=this._paintEventLabel(t,o,p,g,h.width,h.height,r,c,i),w=[y.elmt,b.elmt],E=this,S=function(e,n,r){return E._onClickInstantEvent(y.elmt,n,t)};e.DOM.registerEvent(y.elmt,"mousedown",S),e.DOM.registerEvent(b.elmt,"mousedown",S);var x=this._createHighlightDiv(i,y,r,t);x!=null&&w.push(x),this._fireEventPaintListeners("paintedEvent",t,w),this._eventIdToElmt[t.getID()]=y.elmt,this._tracks[m]=l},n.prototype.paintImpreciseInstantEvent=function(t,n,r,i){var s=this._timeline.getDocument(),o=t.getText(),u=t.getStart(),a=t.getEnd(),f=Math.round(this._band.dateToPixelOffset(u)),l=Math.round(this._band.dateToPixelOffset(a)),c=Math.round(f+n.iconWidth/2),h=Math.round(f-n.iconWidth/2),p=this._getLabelDivClassName(t),d=this._frc.computeSize(o,p),v=c+r.event.label.offsetFromLine,m=v+d.width,g=Math.max(m,l),y=this._findFreeTrack(t,g),b=r.event.tape.height,w=Math.round(n.trackOffset+y*n.trackIncrement+b),E=this._paintEventIcon(t,y,h,n,r,b),S=this._paintEventLabel(t,o,v,w,d.width,d.height,r,p,i),x=t.getColor();x=x!=null?x:r.event.instant.impreciseColor;var T=this._paintEventTape(t,y,f,l,x,r.event.instant.impreciseOpacity,n,r,0),N=[E.elmt,S.elmt,T.elmt],C=this,k=function(e,n,r){return C._onClickInstantEvent(E.elmt,n,t)};e.DOM.registerEvent(E.elmt,"mousedown",k),e.DOM.registerEvent(T.elmt,"mousedown",k),e.DOM.registerEvent(S.elmt,"mousedown",k);var L=this._createHighlightDiv(i,E,r,t);L!=null&&N.push(L),this._fireEventPaintListeners("paintedEvent",t,N),this._eventIdToElmt[t.getID()]=E.elmt,this._tracks[y]=h},n.prototype.paintPreciseDurationEvent=function(t,n,r,i){var s=this._timeline.getDocument(),o=t.getText(),u=t.getStart(),a=t.getEnd(),f=Math.round(this._band.dateToPixelOffset(u)),l=Math.round(this._band.dateToPixelOffset(a)),c=this._getLabelDivClassName(t),h=this._frc.computeSize(o,c),p=f,d=p+h.width,v=Math.max(d,l),m=this._findFreeTrack(t,v),g=Math.round(n.trackOffset+m*n.trackIncrement+r.event.tape.height),y=t.getColor();y=y!=null?y:r.event.duration.color;var b=this._paintEventTape(t,m,f,l,y,100,n,r,0),w=this._paintEventLabel(t,o,p,g,h.width,h.height,r,c,i),E=[b.elmt,w.elmt],S=this,x=function(e,n,r){return S._onClickDurationEvent(b.elmt,n,t)};e.DOM.registerEvent(b.elmt,"mousedown",x),e.DOM.registerEvent(w.elmt,"mousedown",x);var T=this._createHighlightDiv(i,b,r,t);T!=null&&E.push(T),this._fireEventPaintListeners("paintedEvent",t,E),this._eventIdToElmt[t.getID()]=b.elmt,this._tracks[m]=f},n.prototype.paintImpreciseDurationEvent=function(t,n,r,i){var s=this._timeline.getDocument(),o=t.getText(),u=t.getStart(),a=t.getLatestStart(),f=t.getEnd(),l=t.getEarliestEnd(),c=Math.round(this._band.dateToPixelOffset(u)),h=Math.round(this._band.dateToPixelOffset(a)),p=Math.round(this._band.dateToPixelOffset(f)),d=Math.round(this._band.dateToPixelOffset(l)),v=this._getLabelDivClassName(t),m=this._frc.computeSize(o,v),g=h,y=g+m.width,b=Math.max(y,p),w=this._findFreeTrack(t,b),E=Math.round(n.trackOffset+w*n.trackIncrement+r.event.tape.height),S=t.getColor();S=S!=null?S:r.event.duration.color;var x=this._paintEventTape(t,w,c,p,r.event.duration.impreciseColor,r.event.duration.impreciseOpacity,n,r,0),T=this._paintEventTape(t,w,h,d,S,100,n,r,1),N=this._paintEventLabel(t,o,g,E,m.width,m.height,r,v,i),C=[x.elmt,T.elmt,N.elmt],k=this,L=function(e,n,r){return k._onClickDurationEvent(T.elmt,n,t)};e.DOM.registerEvent(T.elmt,"mousedown",L),e.DOM.registerEvent(N.elmt,"mousedown",L);var A=this._createHighlightDiv(i,T,r,t);A!=null&&C.push(A),this._fireEventPaintListeners("paintedEvent",t,C),this._eventIdToElmt[t.getID()]=T.elmt,this._tracks[w]=c},n.prototype._encodeEventElID=function(e,n){return t.encodeEventElID(this._timeline,this._band,e,n)},n.prototype._findFreeTrack=function(e,t){var n=e.getTrackNum();if(n!=null)return n;for(var r=0;r<this._tracks.length;r++){var i=this._tracks[r];if(i>t)break}return r},n.prototype._paintEventIcon=function(t,n,r,i,s,o){var u=t.getIcon();u=u!=null?u:i.icon;var a;if(o>0)a=i.trackOffset+n*i.trackIncrement+o+i.impreciseIconMargin;else{var f=i.trackOffset+n*i.trackIncrement+i.trackHeight/2;a=Math.round(f-i.iconHeight/2)}var l=e.Graphics.createTranslucentImage(u),c=this._timeline.getDocument().createElement("div");return c.className=this._getElClassName("timeline-event-icon",t,"icon"),c.id=this._encodeEventElID("icon",t),c.style.left=r+"px",c.style.top=a+"px",c.appendChild(l),t._title!=null&&(c.title=t._title),this._eventLayer.appendChild(c),{left:r,top:a,width:i.iconWidth,height:i.iconHeight,elmt:c}},n.prototype._paintEventLabel=function(e,t,n,r,i,s,o,u,a){var f=this._timeline.getDocument(),l=f.createElement("div");l.className=u,l.id=this._encodeEventElID("label",e),l.style.left=n+"px",l.style.width=i+"px",l.style.top=r+"px",l.innerHTML=t,e._title!=null&&(l.title=e._title);var c=e.getTextColor();return c==null&&(c=e.getColor()),c!=null&&(l.style.color=c),o.event.highlightLabelBackground&&a>=0&&(l.style.background=this._getHighlightColor(a,o)),this._eventLayer.appendChild(l),{left:n,top:r,width:i,height:s,elmt:l}},n.prototype._paintEventTape=function(t,n,r,i,s,o,u,a,f){var l=i-r,c=a.event.tape.height,h=u.trackOffset+n*u.trackIncrement,p=this._timeline.getDocument().createElement("div");p.className=this._getElClassName("timeline-event-tape",t,"tape"),p.id=this._encodeEventElID("tape"+f,t),p.style.left=r+"px",p.style.width=l+"px",p.style.height=c+"px",p.style.top=h+"px",t._title!=null&&(p.title=t._title),s!=null&&(p.style.backgroundColor=s);var d=t.getTapeImage(),v=t.getTapeRepeat();return v=v!=null?v:"repeat",d!=null&&(p.style.backgroundImage="url("+d+")",p.style.backgroundRepeat=v),e.Graphics.setOpacity(p,o),this._eventLayer.appendChild(p),{left:r,top:h,width:l,height:c,elmt:p}},n.prototype._getLabelDivClassName=function(e){return this._getElClassName("timeline-event-label",e,"label")},n.prototype._getElClassName=function(e,t,n){var r=t.getClassName(),i=[];return r&&(n&&i.push(n+"-"+r+" "),i.push(r+" ")),i.push(e),i.join("")},n.prototype._getHighlightColor=function(e,t){var n=t.event.highlightColors;return n[Math.min(e,n.length-1)]},n.prototype._createHighlightDiv=function(e,t,n,r){var i=null;if(e>=0){var s=this._timeline.getDocument(),o=this._getHighlightColor(e,n);i=s.createElement("div"),i.className=this._getElClassName("timeline-event-highlight",r,"highlight"),i.id=this._encodeEventElID("highlight0",r),i.style.position="absolute",i.style.overflow="hidden",i.style.left=t.left-2+"px",i.style.width=t.width+4+"px",i.style.top=t.top-2+"px",i.style.height=t.height+4+"px",i.style.background=o,this._highlightLayer.appendChild(i)}return i},n.prototype._onClickInstantEvent=function(t,n,r){var i=e.DOM.getPageCoordinates(t);return this._showBubble(i.left+Math.ceil(t.offsetWidth/2),i.top+Math.ceil(t.offsetHeight/2),r),this._fireOnSelect(r.getID()),n.cancelBubble=!0,e.DOM.cancelEvent(n),!1},n.prototype._onClickDurationEvent=function(t,n,r){if("pageX"in n)var i=n.pageX,s=n.pageY;else var o=e.DOM.getPageCoordinates(t),i=n.offsetX+o.left,s=n.offsetY+o.top;return this._showBubble(i,s,r),this._fireOnSelect(r.getID()),n.cancelBubble=!0,e.DOM.cancelEvent(n),!1},n.prototype.showBubble=function(t){var n=this._eventIdToElmt[t.getID()];if(n){var r=e.DOM.getPageCoordinates(n);this._showBubble(r.left+n.offsetWidth/2,r.top+n.offsetHeight/2,t)}},n.prototype._showBubble=function(t,n,r){var i=document.createElement("div"),s=this._params.theme.event.bubble;r.fillInfoBubble(i,this._params.theme,this._band.getLabeller()),e.WindowManager.cancelPopups(),e.Graphics.createBubbleForContentAndPoint(i,t,n,s.width,null,s.maxHeight)},n.prototype._fireOnSelect=function(e){for(var t=0;t<this._onSelectListeners.length;t++)this._onSelectListeners[t](e)},n.prototype._fireEventPaintListeners=function(e,t,n){for(var r=0;r<this._eventPaintListeners.length;r++)this._eventPaintListeners[r](this._band,e,t,n)},n}),define("scripts/hot-zone-ether",["simile-ajax"],function(e){var t=function(e){this._params=e,this._interval=e.interval,this._pixelsPerInterval=e.pixelsPerInterval,this._theme=e.theme};return t.prototype.initialize=function(e,t){this._band=e,this._timeline=t,this._unit=t.getUnit(),this._zones=[{startTime:Number.NEGATIVE_INFINITY,endTime:Number.POSITIVE_INFINITY,magnify:1}];var n=this._params;for(var r=0;r<n.zones.length;r++){var i=n.zones[r],s=this._unit.parseFromObject(i.start),o=this._unit.parseFromObject(i.end);for(var u=0;u<this._zones.length&&this._unit.compare(o,s)>0;u++){var a=this._zones[u];this._unit.compare(s,a.endTime)<0&&(this._unit.compare(s,a.startTime)>0&&(this._zones.splice(u,0,{startTime:a.startTime,endTime:s,magnify:a.magnify}),u++,a.startTime=s),this._unit.compare(o,a.endTime)<0?(this._zones.splice(u,0,{startTime:s,endTime:o,magnify:i.magnify*a.magnify}),u++,a.startTime=o,s=o):(a.magnify*=i.magnify,s=a.endTime))}}"startsOn"in this._params?this._start=this._unit.parseFromObject(this._params.startsOn):"endsOn"in this._params?(this._start=this._unit.parseFromObject(this._params.endsOn),this.shiftPixels(-this._timeline.getPixelLength())):"centersOn"in this._params?(this._start=this._unit.parseFromObject(this._params.centersOn),this.shiftPixels(-this._timeline.getPixelLength()/2)):(this._start=this._unit.makeDefaultValue(),this.shiftPixels(-this._timeline.getPixelLength()/2))},t.prototype.setDate=function(e){this._start=this._unit.cloneValue(e)},t.prototype.shiftPixels=function(e){this._start=this.pixelOffsetToDate(e)},t.prototype.dateToPixelOffset=function(e){return this._dateDiffToPixelOffset(this._start,e)},t.prototype.pixelOffsetToDate=function(e){return this._pixelOffsetToDate(e,this._start)},t.prototype.zoom=function(t){var n=0,r=this._band._zoomIndex,i=r;return t&&r>0&&(i=r-1),!t&&r<this._band._zoomSteps.length-1&&(i=r+1),this._band._zoomIndex=i,this._interval=e.DateTime.gregorianUnitLengths[this._band._zoomSteps[i].unit],this._pixelsPerInterval=this._band._zoomSteps[i].pixelsPerInterval,n=this._band._zoomSteps[i].unit-this._band._zoomSteps[r].unit,n},t.prototype._dateDiffToPixelOffset=function(e,t){var n=this._getScale(),r=e,i=t,s=0;if(this._unit.compare(r,i)<0){var o=0;while(o<this._zones.length){if(this._unit.compare(r,this._zones[o].endTime)<0)break;o++}while(this._unit.compare(r,i)<0){var u=this._zones[o],a=this._unit.earlier(i,u.endTime);s+=this._unit.compare(a,r)/(n/u.magnify),r=a,o++}}else{var o=this._zones.length-1;while(o>=0){if(this._unit.compare(r,this._zones[o].startTime)>0)break;o--}while(this._unit.compare(r,i)>0){var u=this._zones[o],a=this._unit.later(i,u.startTime);s+=this._unit.compare(a,r)/(n/u.magnify),r=a,o--}}return s},t.prototype._pixelOffsetToDate=function(e,t){var n=this._getScale(),r=t;if(e>0){var i=0;while(i<this._zones.length){if(this._unit.compare(r,this._zones[i].endTime)<0)break;i++}while(e>0){var s=this._zones[i],o=n/s.magnify;if(s.endTime==Number.POSITIVE_INFINITY)r=this._unit.change(r,e*o),e=0;else{var u=this._unit.compare(s.endTime,r)/o;u>e?(r=this._unit.change(r,e*o),e=0):(r=s.endTime,e-=u)}i++}}else{var i=this._zones.length-1;while(i>=0){if(this._unit.compare(r,this._zones[i].startTime)>0)break;i--}e=-e;while(e>0){var s=this._zones[i],o=n/s.magnify;if(s.startTime==Number.NEGATIVE_INFINITY)r=this._unit.change(r,-e*o),e=0;else{var u=this._unit.compare(r,s.startTime)/o;u>e?(r=this._unit.change(r,-e*o),e=0):(r=s.startTime,e-=u)}i--}}return r},t.prototype._getScale=function(){return this._interval/this._pixelsPerInterval},t}),define("scripts/themes",["./timeline-base"],function(e){var t=new Object;return t.implementations=[],t.create=function(n){n==null&&(n=e.getDefaultLocale());var r=t.implementations[n];return r==null&&(r=t._Impl),new r},t._Impl=function(){this.firstDayOfWeek=0,this.autoWidth=!1,this.autoWidthAnimationTime=500,this.timeline_start=null,this.timeline_stop=null,this.ether={backgroundColors:[],highlightOpacity:50,interval:{line:{show:!0,opacity:25},weekend:{opacity:30},marker:{hAlign:"Bottom",vAlign:"Right"}}},this.event={track:{height:10,gap:2,offset:2,autoWidthMargin:1.5},overviewTrack:{offset:20,tickHeight:6,height:2,gap:1,autoWidthMargin:5},tape:{height:4},instant:{icon:e.urlPrefix+"images/dull-blue-circle.png",iconWidth:10,iconHeight:10,impreciseOpacity:20,impreciseIconMargin:3},duration:{impreciseOpacity:20},label:{backgroundOpacity:50,offsetFromLine:3},highlightColors:["#FFFF00","#FFC000","#FF0000","#0000FF"],highlightLabelBackground:!1,bubble:{width:250,maxHeight:0,titleStyler:function(e){e.className="timeline-event-bubble-title"},bodyStyler:function(e){e.className="timeline-event-bubble-body"},imageStyler:function(e){e.className="timeline-event-bubble-image"},wikiStyler:function(e){e.className="timeline-event-bubble-wiki"},timeStyler:function(e){e.className="timeline-event-bubble-time"}}},this.mouseWheel="scroll"},t}),define("scripts/timeline-core",["simile-ajax","./timeline-base","./timeline-impl","./linear-ether","./gregorian-ether-painter","./hot-zone-gregorian-ether-painter","./overview-painter","./detailed-painter","./original-painter","./hot-zone-ether","./themes"],function(SimileAjax,Timeline,TimelineImpl,LinearEther,GregorianEtherPainter,HotZoneGregorianEtherPainter,OverviewEventPainter,DetailedEventPainter,OriginalEventPainter,HotZoneEther,ClassicTheme){return Timeline.getDefaultLocale=function(){return Timeline.clientLocale},Timeline.getTimelineFromID=function(e){return Timeline.timelines[e]},Timeline.create=function(e,t,n,r){Timeline.timelines==null&&(Timeline.timelines=[]);var i=Timeline.timelines.length;Timeline.timelines[i]=null;var s=new TimelineImpl(e,t,n,r,i);return Timeline.timelines[i]=s,s},Timeline.createBandInfo=function(e){var t="theme"in e?e.theme:Timeline.getDefaultTheme(),n="decorators"in e?e.decorators:[],r="eventSource"in e?e.eventSource:null,i=new LinearEther({centersOn:"date"in e?e.date:new Date,interval:SimileAjax.DateTime.gregorianUnitLengths[e.intervalUnit],pixelsPerInterval:e.intervalPixels,theme:t}),s=new GregorianEtherPainter({unit:e.intervalUnit,multiple:"multiple"in e?e.multiple:1,theme:t,align:"align"in e?e.align:undefined}),o={showText:"showEventText"in e?e.showEventText:!0,theme:t};if("eventPainterParams"in e)for(var u in e.eventPainterParams)o[u]=e.eventPainterParams[u];"trackHeight"in e&&(o.trackHeight=e.trackHeight),"trackGap"in e&&(o.trackGap=e.trackGap);var a="overview"in e&&e.overview?"overview":"layout"in e?e.layout:"original",f;if("eventPainter"in e)f=new e.eventPainter(o);else switch(a){case"overview":f=new OverviewEventPainter(o);break;case"detailed":f=new DetailedEventPainter(o);break;default:f=new OriginalEventPainter(o)}return{width:e.width,eventSource:r,timeZone:"timeZone"in e?e.timeZone:0,ether:i,etherPainter:s,eventPainter:f,theme:t,decorators:n,zoomIndex:"zoomIndex"in e?e.zoomIndex:0,zoomSteps:"zoomSteps"in e?e.zoomSteps:null}},Timeline.createHotZoneBandInfo=function(e){var t="theme"in e?e.theme:Timeline.getDefaultTheme(),n="eventSource"in e?e.eventSource:null,r=new HotZoneEther({centersOn:"date"in e?e.date:new Date,interval:SimileAjax.DateTime.gregorianUnitLengths[e.intervalUnit],pixelsPerInterval:e.intervalPixels,zones:e.zones,theme:t}),i=new HotZoneGregorianEtherPainter({unit:e.intervalUnit,zones:e.zones,theme:t,align:"align"in e?e.align:undefined}),s={showText:"showEventText"in e?e.showEventText:!0,theme:t};if("eventPainterParams"in e)for(var o in e.eventPainterParams)s[o]=e.eventPainterParams[o];"trackHeight"in e&&(s.trackHeight=e.trackHeight),"trackGap"in e&&(s.trackGap=e.trackGap);var u="overview"in e&&e.overview?"overview":"layout"in e?e.layout:"original",a;if("eventPainter"in e)a=new e.eventPainter(s);else switch(u){case"overview":a=new OverviewEventPainter(s);break;case"detailed":a=new DetailedEventPainter(s);break;default:a=new OriginalEventPainter(s)}return{width:e.width,eventSource:n,timeZone:"timeZone"in e?e.timeZone:0,ether:r,etherPainter:i,eventPainter:a,theme:t,zoomIndex:"zoomIndex"in e?e.zoomIndex:0,zoomSteps:"zoomSteps"in e?e.zoomSteps:null}},Timeline.getDefaultTheme=function(){return Timeline._defaultTheme==null&&(Timeline._defaultTheme=ClassicTheme.create(Timeline.getDefaultLocale())),Timeline._defaultTheme},Timeline.setDefaultTheme=function(e){Timeline._defaultTheme=e},Timeline.loadXML=function(e,t){var n=function(t,n,r){alert("Failed to load data xml from "+e+"\n"+t)},r=function(n){var r=n.responseXML;!r.documentElement&&n.responseStream&&r.load(n.responseStream),t(r,e)};SimileAjax.XmlHttp.get(e,n,r)},Timeline.loadJSON=function(url,f){var fError=function(e,t,n){alert("Failed to load json data from "+url+"\n"+e)},fDone=function(xmlhttp){f(eval("("+xmlhttp.responseText+")"),url)};SimileAjax.XmlHttp.get(url,fError,fDone)},Timeline.writeVersion=function(e){document.getElementById(e).innerHTML=this.display_version},Timeline}),define("scripts/span-decorator",["simile-ajax"],function(e){var t=function(t){this._unit=t.unit!=null?t.unit:e.NativeDateUnit,this._startDate=typeof t.startDate=="string"?this._unit.parseFromObject(t.startDate):t.startDate,this._endDate=typeof t.endDate=="string"?this._unit.parseFromObject(t.endDate):t.endDate,this._startLabel=t.startLabel!=null?t.startLabel:"",this._endLabel=t.endLabel!=null?t.endLabel:"",this._color=t.color,this._cssClass=t.cssClass!=null?t.cssClass:null,this._opacity=t.opacity!=null?t.opacity:100,this._zIndex=t.inFront!=null&&t.inFront?113:10};return t.prototype.initialize=function(e,t){this._band=e,this._timeline=t,this._layerDiv=null},t.prototype.paint=function(){this._layerDiv!=null&&this._band.removeLayerDiv(this._layerDiv),this._layerDiv=this._band.createLayerDiv(this._zIndex),this._layerDiv.setAttribute("name","span-highlight-decorator"),this._layerDiv.style.display="none";var t=this._band.getMinDate(),n=this._band.getMaxDate();if(this._unit.compare(this._startDate,n)<0&&this._unit.compare(this._endDate,t)>0){t=this._unit.later(t,this._startDate),n=this._unit.earlier(n,this._endDate);var r=this._band.dateToPixelOffset(t),i=this._band.dateToPixelOffset(n),s=this._timeline.getDocument(),o=function(){var e=s.createElement("table");return e.insertRow(0).insertCell(0),e},u=s.createElement("div");u.className="timeline-highlight-decorator",this._cssClass&&(u.className+=" "+this._cssClass),this._color!=null&&(u.style.backgroundColor=this._color),this._opacity<100&&e.Graphics.setOpacity(u,this._opacity),this._layerDiv.appendChild(u);var a=o();a.className="timeline-highlight-label timeline-highlight-label-start";var f=a.rows[0].cells[0];f.innerHTML=this._startLabel,this._cssClass&&(f.className="label_"+this._cssClass),this._layerDiv.appendChild(a);var l=o();l.className="timeline-highlight-label timeline-highlight-label-end";var c=l.rows[0].cells[0];c.innerHTML=this._endLabel,this._cssClass&&(c.className="label_"+this._cssClass),this._layerDiv.appendChild(l),this._timeline.isHorizontal()?(u.style.left=r+"px",u.style.width=i-r+"px",a.style.right=this._band.getTotalViewLength()-r+"px",a.style.width=this._startLabel.length+"em",l.style.left=i+"px",l.style.width=this._endLabel.length+"em"):(u.style.top=r+"px",u.style.height=i-r+"px",a.style.bottom=r+"px",a.style.height="1.5px",l.style.top=i+"px",l.style.height="1.5px")}this._layerDiv.style.display="block"},t.prototype.softPaint=function(){},t}),define("scripts/point-decorator",["simile-ajax"],function(e){var t=function(t){this._unit=t.unit!=null?t.unit:e.NativeDateUnit,this._date=typeof t.date=="string"?this._unit.parseFromObject(t.date):t.date,this._width=t.width!=null?t.width:10,this._color=t.color,this._cssClass=t.cssClass!=null?t.cssClass:"",this._opacity=t.opacity!=null?t.opacity:100};return t.prototype.initialize=function(e,t){this._band=e,this._timeline=t,this._layerDiv=null},t.prototype.paint=function(){this._layerDiv!=null&&this._band.removeLayerDiv(this._layerDiv),this._layerDiv=this._band.createLayerDiv(10),this._layerDiv.setAttribute("name","span-highlight-decorator"),this._layerDiv.style.display="none";var t=this._band.getMinDate(),n=this._band.getMaxDate();if(this._unit.compare(this._date,n)<0&&this._unit.compare(this._date,t)>0){var r=this._band.dateToPixelOffset(this._date),i=r-Math.round(this._width/2),s=this._timeline.getDocument(),o=s.createElement("div");o.className="timeline-highlight-point-decorator",o.className+=" "+this._cssClass,this._color!=null&&(o.style.backgroundColor=this._color),this._opacity<100&&e.Graphics.setOpacity(o,this._opacity),this._layerDiv.appendChild(o),this._timeline.isHorizontal()?(o.style.left=i+"px",o.style.width=this._width+"px"):(o.style.top=i+"px",o.style.height=this._width+"px")}this._layerDiv.style.display="block"},t.prototype.softPaint=function(){},t}),define("scripts/sources",["simile-ajax","./timeline-base","./event-utils","i18n!nls/timeline"],function(e,t,n,r){return DefaultEventSource=function(t){this._events=t instanceof Object?t:new e.EventIndex,this._listeners=[]},DefaultEventSource.prototype.addListener=function(e){this._listeners.push(e)},DefaultEventSource.prototype.removeListener=function(e){for(var t=0;t<this._listeners.length;t++)if(this._listeners[t]==e){this._listeners.splice(t,1);break}},DefaultEventSource.prototype.loadXML=function(e,t){var n=this._getBaseURL(t),r=e.documentElement.getAttribute("wiki-url"),i=e.documentElement.getAttribute("wiki-section"),s=e.documentElement.getAttribute("date-time-format"),o=this._events.getUnit().getParser(s),u=e.documentElement.firstChild,a=!1;while(u!=null){if(u.nodeType==1){var f="";u.firstChild!=null&&u.firstChild.nodeType==3&&(f=u.firstChild.nodeValue);var l=u.getAttribute("isDuration")===null&&u.getAttribute("durationEvent")===null||u.getAttribute("isDuration")=="false"||u.getAttribute("durationEvent")=="false",c=new DefaultEventSource.Event({id:u.getAttribute("id"),start:o(u.getAttribute("start")),end:o(u.getAttribute("end")),latestStart:o(u.getAttribute("latestStart")),earliestEnd:o(u.getAttribute("earliestEnd")),instant:l,text:u.getAttribute("title"),description:f,image:this._resolveRelativeURL(u.getAttribute("image"),n),link:this._resolveRelativeURL(u.getAttribute("link"),n),icon:this._resolveRelativeURL(u.getAttribute("icon"),n),color:u.getAttribute("color"),textColor:u.getAttribute("textColor"),hoverText:u.getAttribute("hoverText"),classname:u.getAttribute("classname"),tapeImage:u.getAttribute("tapeImage"),tapeRepeat:u.getAttribute("tapeRepeat"),caption:u.getAttribute("caption"),eventID:u.getAttribute("eventID"),trackNum:u.getAttribute("trackNum")});c._node=u,c.getProperty=function(e){return this._node.getAttribute(e)},c.setWikiInfo(r,i),this._events.add(c),a=!0}u=u.nextSibling}a&&this._fire("onAddMany",[])},DefaultEventSource.prototype.loadJSON=function(e,t){var n=this._getBaseURL(t),r=!1;if(e&&e.events){var i="wikiURL"in e?e.wikiURL:null,s="wikiSection"in e?e.wikiSection:null,o="dateTimeFormat"in e?e.dateTimeFormat:null,u=this._events.getUnit().getParser(o);for(var a=0;a<e.events.length;a++){var f=e.events[a],l=f.isDuration||"durationEvent"in f&&!f.durationEvent||"de"in f&&!f.de,c=new DefaultEventSource.Event({id:"id"in f?f.id:undefined,start:u(f.start||f.s),end:u(f.end||f.e),latestStart:u(f.latestStart||f.ls),earliestEnd:u(f.earliestEnd||f.ee),instant:l,text:f.title||f.t,description:f.description||f.d,image:this._resolveRelativeURL(f.image,n),link:this._resolveRelativeURL(f.link,n),icon:this._resolveRelativeURL(f.icon,n),color:f.color,textColor:f.textColor,hoverText:f.hoverText,classname:f.classname||f.c,tapeImage:f.tapeImage,tapeRepeat:f.tapeRepeat,caption:f.caption,eventID:f.eventID||f.eid,trackNum:f.trackNum});c._obj=f,c.getProperty=function(e){return this._obj[e]},c.setWikiInfo(i,s),this._events.add(c),r=!0}}r&&this._fire("onAddMany",[])},DefaultEventSource.prototype.loadSPARQL=function(e,t){var n=this._getBaseURL(t),r="iso8601",i=this._events.getUnit().getParser(r);if(e==null)return;var s=e.documentElement.firstChild;while(s!=null&&(s.nodeType!=1||s.nodeName!="results"))s=s.nextSibling;var o=null,u=null;s!=null&&(o=s.getAttribute("wiki-url"),u=s.getAttribute("wiki-section"),s=s.firstChild);var a=!1;while(s!=null){if(s.nodeType==1){var f={},l=s.firstChild;while(l!=null)l.nodeType==1&&l.firstChild!=null&&l.firstChild.nodeType==1&&l.firstChild.firstChild!=null&&l.firstChild.firstChild.nodeType==3&&(f[l.getAttribute("name")]=l.firstChild.firstChild.nodeValue),l=l.nextSibling;f["start"]==null&&f["date"]!=null&&(f.start=f.date);var c=f.isDuration===null&&f.durationEvent===null||f["isDuration"]=="false"||f["durationEvent"]=="false",h=new DefaultEventSource.Event({id:f.id,start:i(f.start),end:i(f.end),latestStart:i(f.latestStart),earliestEnd:i(f.earliestEnd),instant:c,text:f.title,description:f.description,image:this._resolveRelativeURL(f.image,n),link:this._resolveRelativeURL(f.link,n),icon:this._resolveRelativeURL(f.icon,n),color:f.color,textColor:f.textColor,hoverText:f.hoverText,caption:f.caption,classname:f.classname,tapeImage:f.tapeImage,tapeRepeat:f.tapeRepeat,eventID:f.eventID,trackNum:f.trackNum});h._bindings=f,h.getProperty=function(e){return this._bindings[e]},h.setWikiInfo(o,u),this._events.add(h),a=!0}s=s.nextSibling}a&&this._fire("onAddMany",[])},DefaultEventSource.prototype.add=function(e){this._events.add(e),this._fire("onAddOne",[e])},DefaultEventSource.prototype.addMany=function(e){for(var t=0;t<e.length;t++)this._events.add(e[t]);this._fire("onAddMany",[])},DefaultEventSource.prototype.clear=function(){this._events.removeAll(),this._fire("onClear",[])},DefaultEventSource.prototype.getEvent=function(e){return this._events.getEvent(e)},DefaultEventSource.prototype.getEventIterator=function(e,t){return this._events.getIterator(e,t)},DefaultEventSource.prototype.getEventReverseIterator=function(e,t){return this._events.getReverseIterator(e,t)},DefaultEventSource.prototype.getAllEventIterator=function(){return this._events.getAllIterator()},DefaultEventSource.prototype.getCount=function(){return this._events.getCount()},DefaultEventSource.prototype.getEarliestDate=function(){return this._events.getEarliestDate()},DefaultEventSource.prototype.getLatestDate=function(){return this._events.getLatestDate()},DefaultEventSource.prototype._fire=function(t,n){for(var r=0;r<this._listeners.length;r++){var i=this._listeners[r];if(t in i)try{i[t].apply(i,n)}catch(s){e.Debug.exception(s)}}},DefaultEventSource.prototype._getBaseURL=function(e){if(e.indexOf("://")<0){var t=this._getBaseURL(document.location.href);e.substr(0,1)=="/"?e=t.substr(0,t.indexOf("/",t.indexOf("://")+3))+e:e=t+e}var n=e.lastIndexOf("/");return n<0?"":e.substr(0,n+1)},DefaultEventSource.prototype._resolveRelativeURL=function(e,t){return e==null||e==""?e:e.indexOf("://")>0?e:e.substr(0,1)=="/"?t.substr(0,t.indexOf("/",t.indexOf("://")+3))+e:t+e},DefaultEventSource.Event=function(t){function r(e){return t[e]!=null&&t[e]!=""?t[e]:null}var i=t.id?t.id.trim():"";this._id=i.length>0?i:n.getNewEventID(),this._instant=t.instant||t.end==null,this._start=t.start,this._end=t.end!=null?t.end:t.start,this._latestStart=t.latestStart!=null?t.latestStart:t.instant?this._end:this._start,this._earliestEnd=t.earliestEnd!=null?t.earliestEnd:this._end;var s=[];this._start>this._latestStart&&(this._latestStart=this._start,s.push("start is > latestStart")),this._start>this._earliestEnd&&(this._earliestEnd=this._latestStart,s.push("start is > earliestEnd")),this._start>this._end&&(this._end=this._earliestEnd,s.push("start is > end")),this._latestStart>this._earliestEnd&&(this._earliestEnd=this._latestStart,s.push("latestStart is > earliestEnd")),this._latestStart>this._end&&(this._end=this._earliestEnd,s.push("latestStart is > end")),this._earliestEnd>this._end&&(this._end=this._earliestEnd,s.push("earliestEnd is > end")),this._eventID=r("eventID"),this._text=t.text!=null?e.HTML.deEntify(t.text):"",s.length>0&&(this._text+=" PROBLEM: "+s.join(", ")),this._description=e.HTML.deEntify(t.description),this._image=r("image"),this._link=r("link"),this._title=r("hoverText"),this._title=r("caption"),this._icon=r("icon"),this._color=r("color"),this._textColor=r("textColor"),this._classname=r("classname"),this._tapeImage=r("tapeImage"),this._tapeRepeat=r("tapeRepeat"),this._trackNum=r("trackNum"),this._trackNum!=null&&(this._trackNum=parseInt(this._trackNum)),this._wikiURL=null,this._wikiSection=null},DefaultEventSource.Event.prototype={getID:function(){return this._id},isInstant:function(){return this._instant},isImprecise:function(){return this._start!=this._latestStart||this._end!=this._earliestEnd},getStart:function(){return this._start},getEnd:function(){return this._end},getLatestStart:function(){return this._latestStart},getEarliestEnd:function(){return this._earliestEnd},getEventID:function(){return this._eventID},getText:function(){return this._text},getDescription:function(){return this._description},getImage:function(){return this._image},getLink:function(){return this._link},getIcon:function(){return this._icon},getColor:function(){return this._color},getTextColor:function(){return this._textColor},getClassName:function(){return this._classname},getTapeImage:function(){return this._tapeImage},getTapeRepeat:function(){return this._tapeRepeat},getTrackNum:function(){return this._trackNum},getProperty:function(e){return null},getWikiURL:function(){return this._wikiURL},getWikiSection:function(){return this._wikiSection},setWikiInfo:function(e,t){this._wikiURL=e,this._wikiSection=t},fillDescription:function(e){this._description&&(e.innerHTML=this._description)},fillWikiInfo:function(e){e.style.display="none";if(this._wikiURL==null||this._wikiSection==null)return;var t=this.getProperty("wikiID");if(t==null||t.length==0)t=this.getText();if(t==null||t.length==0)return;e.style.display="inline",t=t.replace(/\s/g,"_");var n=this._wikiURL+this._wikiSection.replace(/\s/g,"_")+"/"+t,i=document.createElement("a");i.href=n,i.target="new",i.innerHTML=r.wikiLinkLabel,e.appendChild(document.createTextNode("[")),e.appendChild(i),e.appendChild(document.createTextNode("]"))},fillTime:function(e,t){this._instant?this.isImprecise()?(e.appendChild(e.ownerDocument.createTextNode(t.labelPrecise(this._start))),e.appendChild(e.ownerDocument.createElement("br")),e.appendChild(e.ownerDocument.createTextNode(t.labelPrecise(this._end)))):e.appendChild(e.ownerDocument.createTextNode(t.labelPrecise(this._start))):this.isImprecise()?(e.appendChild(e.ownerDocument.createTextNode(t.labelPrecise(this._start)+" ~ "+t.labelPrecise(this._latestStart))),e.appendChild(e.ownerDocument.createElement("br")),e.appendChild(e.ownerDocument.createTextNode(t.labelPrecise(this._earliestEnd)+" ~ "+t.labelPrecise(this._end)))):(e.appendChild(e.ownerDocument.createTextNode(t.labelPrecise(this._start))),e.appendChild(e.ownerDocument.createElement("br")),e.appendChild(e.ownerDocument.createTextNode(t.labelPrecise(this._end))))},fillInfoBubble:function(e,t,n){var r=e.ownerDocument,i=this.getText(),s=this.getLink(),o=this.getImage();if(o!=null){var u=r.createElement("img");u.src=o,t.event.bubble.imageStyler(u),e.appendChild(u)}var a=r.createElement("div"),f=r.createTextNode(i);if(s!=null){var l=r.createElement("a");l.href=s,l.appendChild(f),a.appendChild(l)}else a.appendChild(f);t.event.bubble.titleStyler(a),e.appendChild(a);var c=r.createElement("div");this.fillDescription(c),t.event.bubble.bodyStyler(c),e.appendChild(c);var h=r.createElement("div");this.fillTime(h,n),t.event.bubble.timeStyler(h),e.appendChild(h);var p=r.createElement("div");this.fillWikiInfo(p),t.event.bubble.wikiStyler(p),e.appendChild(p)}},DefaultEventSource}),define("scripts/compact-painter",["simile-ajax"],function(e){var t=function(e){this._params=e,this._onSelectListeners=[],this._filterMatcher=null,this._highlightMatcher=null,this._frc=null,this._eventIdToElmt={}};return t.prototype.getType=function(){return"compact"},t.prototype.initialize=function(e,t){this._band=e,this._timeline=t,this._backLayer=null,this._eventLayer=null,this._lineLayer=null,this._highlightLayer=null,this._eventIdToElmt=null},t.prototype.supportsOrthogonalScrolling=function(){return!0},t.prototype.addOnSelectListener=function(e){this._onSelectListeners.push(e)},t.prototype.removeOnSelectListener=function(e){for(var t=0;t<this._onSelectListeners.length;t++)if(this._onSelectListeners[t]==e){this._onSelectListeners.splice(t,1);break}},t.prototype.getFilterMatcher=function(){return this._filterMatcher},t.prototype.setFilterMatcher=function(e){this._filterMatcher=e},t.prototype.getHighlightMatcher=function(){return this._highlightMatcher},t.prototype.setHighlightMatcher=function(e){this._highlightMatcher=e},t.prototype.paint=function(){var e=this._band.getEventSource();if(e==null)return;this._eventIdToElmt={},this._prepareForPainting();var t=this._computeMetrics(),n=this._band.getMinDate(),r=this._band.getMaxDate(),i=this._filterMatcher!=null?this._filterMatcher:function(e){return!0},s=this._highlightMatcher!=null?this._highlightMatcher:function(e){return-1},o=e.getEventIterator(n,r),u="stackConcurrentPreciseInstantEvents"in this._params&&typeof this._params.stackConcurrentPreciseInstantEvents=="object",a="collapseConcurrentPreciseInstantEvents"in this._params&&this._params.collapseConcurrentPreciseInstantEvents;if(a||u){var f=[],l=null;while(o.hasNext()){var c=o.next();i(c)&&(!c.isInstant()||c.isImprecise()?this.paintEvent(c,t,this._params.theme,s(c)):l!=null&&l.getStart().getTime()==c.getStart().getTime()?f[f.length-1].push(c):(f.push([c]),l=c))}for(var h=0;h<f.length;h++){var p=f[h];if(p.length==1)this.paintEvent(p[0],t,this._params.theme,s(c));else{var d=-1;for(var v=0;d<0&&v<p.length;v++)d=s(p[v]);u?this.paintStackedPreciseInstantEvents(p,t,this._params.theme,d):this.paintCompositePreciseInstantEvents(p,t,this._params.theme,d)}}}else while(o.hasNext()){var c=o.next();i(c)&&this.paintEvent(c,t,this._params.theme,s(c))}this._highlightLayer.style.display="block",this._lineLayer.style.display="block",this._eventLayer.style.display="block",this._setOrthogonalOffset(t)},t.prototype.softPaint=function(){this._setOrthogonalOffset(this._computeMetrics())},t.prototype.getOrthogonalExtent=function(){var e=this._computeMetrics();return 2*e.trackOffset+this._tracks.length*e.trackHeight},t.prototype._setOrthogonalOffset=function(e){var t=this._band.getViewOrthogonalOffset();this._highlightLayer.style.top=this._lineLayer.style.top=this._eventLayer.style.top=t+"px"},t.prototype._computeMetrics=function(){var e=this._params.theme,t=e.event,n={trackOffset:"trackOffset"in this._params?this._params.trackOffset:10,trackHeight:"trackHeight"in this._params?this._params.trackHeight:10,tapeHeight:e.event.tape.height,tapeBottomMargin:"tapeBottomMargin"in this._params?this._params.tapeBottomMargin:2,labelBottomMargin:"labelBottomMargin"in this._params?this._params.labelBottomMargin:5,labelRightMargin:"labelRightMargin"in this._params?this._params.labelRightMargin:5,defaultIcon:t.instant.icon,defaultIconWidth:t.instant.iconWidth,defaultIconHeight:t.instant.iconHeight,customIconWidth:"iconWidth"in this._params?this._params.iconWidth:t.instant.iconWidth,customIconHeight:"iconHeight"in this._params?this._params.iconHeight:t.instant.iconHeight,iconLabelGap:"iconLabelGap"in this._params?this._params.iconLabelGap:2,iconBottomMargin:"iconBottomMargin"in this._params?this._params.iconBottomMargin:2};return"compositeIcon"in this._params?(n.compositeIcon=this._params.compositeIcon,n.compositeIconWidth=this._params.compositeIconWidth||n.customIconWidth,n.compositeIconHeight=this._params.compositeIconHeight||n.customIconHeight):(n.compositeIcon=n.defaultIcon,n.compositeIconWidth=n.defaultIconWidth,n.compositeIconHeight=n.defaultIconHeight),n.defaultStackIcon="stackConcurrentPreciseInstantEvents"in this._params&&"icon"in this._params.stackConcurrentPreciseInstantEvents?this._params.stackConcurrentPreciseInstantEvents.icon:n.defaultIcon,n.defaultStackIconWidth="stackConcurrentPreciseInstantEvents"in this._params&&"iconWidth"in this._params.stackConcurrentPreciseInstantEvents?this._params.stackConcurrentPreciseInstantEvents.iconWidth:n.defaultIconWidth,n.defaultStackIconHeight="stackConcurrentPreciseInstantEvents"in this._params&&"iconHeight"in this._params.stackConcurrentPreciseInstantEvents?this._params.stackConcurrentPreciseInstantEvents.iconHeight:n.defaultIconHeight,n},t.prototype._prepareForPainting=function(){var t=this._band;if(this._backLayer==null){this._backLayer=this._band.createLayerDiv(0,"timeline-band-events"),this._backLayer.style.visibility="hidden";var n=document.createElement("span");n.className="timeline-event-label",this._backLayer.appendChild(n),this._frc=e.Graphics.getFontRenderingContext(n)}this._frc.update(),this._tracks=[],this._highlightLayer!=null&&t.removeLayerDiv(this._highlightLayer),this._highlightLayer=t.createLayerDiv(105,"timeline-band-highlights"),this._highlightLayer.style.display="none",this._lineLayer!=null&&t.removeLayerDiv(this._lineLayer),this._lineLayer=t.createLayerDiv(110,"timeline-band-lines"),this._lineLayer.style.display="none",this._eventLayer!=null&&t.removeLayerDiv(this._eventLayer),this._eventLayer=t.createLayerDiv(115,"timeline-band-events"),this._eventLayer.style.display="none"},t.prototype.paintEvent=function(e,t,n,r){e.isInstant()?this.paintInstantEvent(e,t,n,r):this.paintDurationEvent(e,t,n,r)},t.prototype.paintInstantEvent=function(e,t,n,r){e.isImprecise()?this.paintImpreciseInstantEvent(e,t,n,r):this.paintPreciseInstantEvent(e,t,n,r)},t.prototype.paintDurationEvent=function(e,t,n,r){e.isImprecise()?this.paintImpreciseDurationEvent(e,t,n,r):this.paintPreciseDurationEvent(e,t,n,r)},t.prototype.paintPreciseInstantEvent=function(t,n,r,i){var s={tooltip:t.getProperty("tooltip")||t.getText()},o={url:t.getIcon()};o.url==null?(o.url=n.defaultIcon,o.width=n.defaultIconWidth,o.height=n.defaultIconHeight,o.className="timeline-event-icon-default"):(o.width=t.getProperty("iconWidth")||n.customIconWidth,o.height=t.getProperty("iconHeight")||n.customIconHeight);var u={text:t.getText(),color:t.getTextColor()||t.getColor(),className:t.getClassName()},a=this.paintTapeIconLabel(t.getStart(),s,null,o,u,n,r,i),f=this,l=function(e,n,r){return f._onClickInstantEvent(a.iconElmtData.elmt,n,t)};e.DOM.registerEvent(a.iconElmtData.elmt,"mousedown",l),e.DOM.registerEvent(a.labelElmtData.elmt,"mousedown",l),this._eventIdToElmt[t.getID()]=a.iconElmtData.elmt},t.prototype.paintCompositePreciseInstantEvents=function(t,n,r,i){var s=t[0],o=[];for(var u=0;u<t.length;u++)o.push(t[u].getProperty("tooltip")||t[u].getText());var a={tooltip:o.join("; ")},f={url:n.compositeIcon,width:n.compositeIconWidth,height:n.compositeIconHeight,className:"timeline-event-icon-composite"},l={text:e.StringUtils.substitute(this._params.compositeEventLabelTemplate,[t.length])},c=this.paintTapeIconLabel(s.getStart(),a,null,f,l,n,r,i),h=this,p=function(e,n,r){return h._onClickMultiplePreciseInstantEvent(c.iconElmtData.elmt,n,t)};e.DOM.registerEvent(c.iconElmtData.elmt,"mousedown",p),e.DOM.registerEvent(c.labelElmtData.elmt,"mousedown",p);for(var u=0;u<t.length;u++)this._eventIdToElmt[t[u].getID()]=c.iconElmtData.elmt},t.prototype.paintStackedPreciseInstantEvents=function(t,n,r,i){var s="limit"in this._params.stackConcurrentPreciseInstantEvents?this._params.stackConcurrentPreciseInstantEvents.limit:10,o="moreMessageTemplate"in this._params.stackConcurrentPreciseInstantEvents?this._params.stackConcurrentPreciseInstantEvents.moreMessageTemplate:"%0 More Events",u=s<=t.length-2,a=this._band,f=function(e){return Math.round(a.dateToPixelOffset(e))},l=function(e){var t={url:e.getIcon()};return t.url==null?(t.url=n.defaultStackIcon,t.width=n.defaultStackIconWidth,t.height=n.defaultStackIconHeight,t.className="timeline-event-icon-stack timeline-event-icon-default"):(t.width=e.getProperty("iconWidth")||n.customIconWidth,t.height=e.getProperty("iconHeight")||n.customIconHeight,t.className="timeline-event-icon-stack"),t},c=l(t[0]),h=5,p=0,d=0,v=0,m=0,g=[];for(var y=0;y<t.length&&(!u||y<s);y++){var b=t[y],w=b.getText(),E=l(b),S=this._frc.computeSize(w),x={text:w,iconData:E,labelSize:S,iconLeft:c.width+y*h-E.width};x.labelLeft=c.width+y*h+n.iconLabelGap,x.top=v,g.push(x),p=Math.min(p,x.iconLeft),v+=S.height,d=Math.max(d,x.labelLeft+S.width),m=Math.max(m,x.top+E.height)}if(u){var T=e.StringUtils.substitute(o,[t.length-s]),N=this._frc.computeSize(T),C=c.width+(s-1)*h+n.iconLabelGap,k=v;v+=N.height,d=Math.max(d,C+N.width)}d+=n.labelRightMargin,v+=n.labelBottomMargin,m+=n.iconBottomMargin;var L=f(t[0].getStart()),A=[],O=Math.ceil(Math.max(m,v)/n.trackHeight),M=c.width+(t.length-1)*h;for(var y=0;y<O;y++)A.push({start:p,end:M});var _=Math.ceil(v/n.trackHeight);for(var y=0;y<_;y++){var D=A[y];D.end=Math.max(D.end,d)}var P=this._fitTracks(L,A),H=P*n.trackHeight+n.trackOffset,B=this._timeline.getDocument().createElement("div");B.className="timeline-event-icon-stack",B.style.position="absolute",B.style.overflow="visible",B.style.left=L+"px",B.style.top=H+"px",B.style.width=M+"px",B.style.height=m+"px",B.innerHTML="<div style='position: relative'></div>",this._eventLayer.appendChild(B);var j=this,F=function(e){try{var t=parseInt(this.getAttribute("index")),n=B.firstChild.childNodes;for(var r=0;r<n.length;r++){var i=n[r];r==t?i.style.zIndex=n.length:i.style.zIndex=n.length-r}}catch(s){}},I=function(n){var i=g[n],s=t[n],o=s.getProperty("tooltip")||s.getText(),u=j._paintEventLabel({tooltip:o},{text:i.text},L+i.labelLeft,H+i.top,i.labelSize.width,i.labelSize.height,r);u.elmt.setAttribute("index",n),u.elmt.onmouseover=F;var a=e.Graphics.createTranslucentImage(i.iconData.url),f=j._timeline.getDocument().createElement("div");f.className="timeline-event-icon"+("className"in i.iconData?" "+i.iconData.className:""),f.style.left=i.iconLeft+"px",f.style.top=i.top+"px",f.style.zIndex=g.length-n,f.appendChild(a),f.setAttribute("index",n),f.onmouseover=F,B.firstChild.appendChild(f);var l=function(e,t,n){return j._onClickInstantEvent(u.elmt,t,s)};e.DOM.registerEvent(f,"mousedown",l),e.DOM.registerEvent(u.elmt,"mousedown",l),j._eventIdToElmt[s.getID()]=f};for(var y=0;y<g.length;y++)I(y);if(u){var q=t.slice(s),R=this._paintEventLabel({tooltip:T},{text:T},L+C,H+k,N.width,N.height,r),U=function(e,t,n){return j._onClickMultiplePreciseInstantEvent(R.elmt,t,q)};e.DOM.registerEvent(R.elmt,"mousedown",U);for(var y=0;y<q.length;y++)this._eventIdToElmt[q[y].getID()]=R.elmt}},t.prototype.paintImpreciseInstantEvent=function(t,n,r,i){var s={tooltip:t.getProperty("tooltip")||t.getText()},o={start:t.getStart(),end:t.getEnd(),latestStart:t.getLatestStart(),earliestEnd:t.getEarliestEnd(),color:t.getColor()||t.getTextColor(),isInstant:!0},u={url:t.getIcon()};u.url==null?u=null:(u.width=t.getProperty("iconWidth")||n.customIconWidth,u.height=t.getProperty("iconHeight")||n.customIconHeight);var a={text:t.getText(),color:t.getTextColor()||t.getColor(),className:t.getClassName()},f=this.paintTapeIconLabel(t.getStart(),s,o,u,a,n,r,i),l=this,c=u!=null?function(e,n,r){return l._onClickInstantEvent(f.iconElmtData.elmt,n,t)}:function(e,n,r){return l._onClickInstantEvent(f.labelElmtData.elmt,n,t)};e.DOM.registerEvent(f.labelElmtData.elmt,"mousedown",c),e.DOM.registerEvent(f.impreciseTapeElmtData.elmt,"mousedown",c),u!=null?(e.DOM.registerEvent(f.iconElmtData.elmt,"mousedown",c),this._eventIdToElmt[t.getID()]=f.iconElmtData.elmt):this._eventIdToElmt[t.getID()]=f.labelElmtData.elmt},t.prototype.paintPreciseDurationEvent=function(t,n,r,i){var s={tooltip:t.getProperty("tooltip")||t.getText()},o={start:t.getStart(),end:t.getEnd(),color:t.getColor()||t.getTextColor(),isInstant:!1},u={url:t.getIcon()};u.url==null?u=null:(u.width=t.getProperty("iconWidth")||n.customIconWidth,u.height=t.getProperty("iconHeight")||n.customIconHeight);var a={text:t.getText(),color:t.getTextColor()||t.getColor(),className:t.getClassName()},f=this.paintTapeIconLabel(t.getLatestStart(),s,o,u,a,n,r,i),l=this,c=u!=null?function(e,n,r){return l._onClickInstantEvent(f.iconElmtData.elmt,n,t)}:function(e,n,r){return l._onClickInstantEvent(f.labelElmtData.elmt,n,t)};e.DOM.registerEvent(f.labelElmtData.elmt,"mousedown",c),e.DOM.registerEvent(f.tapeElmtData.elmt,"mousedown",c),u!=null?(e.DOM.registerEvent(f.iconElmtData.elmt,"mousedown",c),this._eventIdToElmt[t.getID()]=f.iconElmtData.elmt):this._eventIdToElmt[t.getID()]=f.labelElmtData.elmt},t.prototype.paintImpreciseDurationEvent=function(t,n,r,i){var s={tooltip:t.getProperty("tooltip")||t.getText()},o={start:t.getStart(),end:t.getEnd(),latestStart:t.getLatestStart(),earliestEnd:t.getEarliestEnd(),color:t.getColor()||t.getTextColor(),isInstant:!1},u={url:t.getIcon()};u.url==null?u=null:(u.width=t.getProperty("iconWidth")||n.customIconWidth,u.height=t.getProperty("iconHeight")||n.customIconHeight);var a={text:t.getText(),color:t.getTextColor()||t.getColor(),className:t.getClassName()},f=this.paintTapeIconLabel(t.getLatestStart(),s,o,u,a,n,r,i),l=this,c=u!=null?function(e,n,r){return l._onClickInstantEvent(f.iconElmtData.elmt,n,t)}:function(e,n,r){return l._onClickInstantEvent(f.labelElmtData.elmt,n,t)};e.DOM.registerEvent(f.labelElmtData.elmt,"mousedown",c),e.DOM.registerEvent(f.tapeElmtData.elmt,"mousedown",c),u!=null?(e.DOM.registerEvent(f.iconElmtData.elmt,"mousedown",c),this._eventIdToElmt[t.getID()]=f.iconElmtData.elmt):this._eventIdToElmt[t.getID()]=f.labelElmtData.elmt},t.prototype.paintTapeIconLabel=function(e,t,n,r,i,s,o,u){var a=this._band,f=function(e){return Math.round(a.dateToPixelOffset(e))},l=f(e),c=[],h=0,p=0,d=0;if(n!=null){h=s.tapeHeight+s.tapeBottomMargin,p=Math.ceil(s.tapeHeight/s.trackHeight);var v=f(n.end)-l,m=f(n.start)-l;for(var g=0;g<p;g++)c.push({start:m,end:v});d=s.trackHeight-h%s.tapeHeight}var y=0,b=0;if(r!=null){"iconAlign"in r&&r.iconAlign=="center"&&(y=-Math.floor(r.width/2)),b=y+r.width+s.iconLabelGap,p>0&&(c[p-1].end=Math.max(c[p-1].end,b));var w=r.height+s.iconBottomMargin+d;while(w>0)c.push({start:y,end:b}),w-=s.trackHeight}var E=i.text,S=this._frc.computeSize(E),x=S.height+s.labelBottomMargin+d,T=b+S.width+s.labelRightMargin;p>0&&(c[p-1].end=Math.max(c[p-1].end,T));for(var N=0;x>0;N++){if(p+N<c.length){var C=c[p+N];C.end=T}else c.push({start:0,end:T});x-=s.trackHeight}var k=this._fitTracks(l,c),L=k*s.trackHeight+s.trackOffset,A={};A.labelElmtData=this._paintEventLabel(t,i,l+b,L+h,S.width,S.height,o);if(n!=null){if("latestStart"in n||"earliestEnd"in n)A.impreciseTapeElmtData=this._paintEventTape(t,n,s.tapeHeight,L,f(n.start),f(n.end),o.event.duration.impreciseColor,o.event.duration.impreciseOpacity,s,o);!n.isInstant&&"start"in n&&"end"in n&&(A.tapeElmtData=this._paintEventTape(t,n,s.tapeHeight,L,l,f("earliestEnd"in n?n.earliestEnd:n.end),n.color,100,s,o))}return r!=null&&(A.iconElmtData=this._paintEventIcon(t,r,L+h,l+y,s,o)),A},t.prototype._fitTracks=function(e,t){var n;for(n=0;n<this._tracks.length;n++){var r=!0;for(var i=0;i<t.length&&n+i<this._tracks.length;i++){var s=this._tracks[n+i],o=t[i];if(e+o.start<s){r=!1;break}}if(r)break}for(var u=0;u<t.length;u++)this._tracks[n+u]=e+t[u].end;return n},t.prototype._paintEventIcon=function(t,n,r,i,s,o){var u=e.Graphics.createTranslucentImage(n.url),a=this._timeline.getDocument().createElement("div");return a.className="timeline-event-icon"+("className"in n?" "+n.className:""),a.style.left=i+"px",a.style.top=r+"px",a.appendChild(u),"tooltip"in t&&typeof t.tooltip=="string"&&(a.title=t.tooltip),this._eventLayer.appendChild(a),{left:i,top:r,width:s.iconWidth,height:s.iconHeight,elmt:a}},t.prototype._paintEventLabel=function(e,t,n,r,i,s,o){var u=this._timeline.getDocument(),a=u.createElement("div");return a.className="timeline-event-label",a.style.left=n+"px",a.style.width=i+1+"px",a.style.top=r+"px",a.innerHTML=t.text,"tooltip"in e&&typeof e.tooltip=="string"&&(a.title=e.tooltip),"color"in t&&typeof t.color=="string"&&(a.style.color=t.color),"className"in t&&typeof t.className=="string"&&(a.className+=" "+t.className),this._eventLayer.appendChild(a),{left:n,top:r,width:i,height:s,elmt:a}},t.prototype._paintEventTape=function(t,n,r,i,s,o,u,a,f,l){var c=o-s,h=this._timeline.getDocument().createElement("div");return h.className="timeline-event-tape",h.style.left=s+"px",h.style.top=i+"px",h.style.width=c+"px",h.style.height=r+"px","tooltip"in t&&typeof t.tooltip=="string"&&(h.title=t.tooltip),u!=null&&typeof n.color=="string"&&(h.style.backgroundColor=u),"backgroundImage"in n&&typeof n.backgroundImage=="string"&&(h.style.backgroundImage="url("+backgroundImage+")",h.style.backgroundRepeat="backgroundRepeat"in n&&typeof n.backgroundRepeat=="string"?n.backgroundRepeat:"repeat"),e.Graphics.setOpacity(h,a),"className"in n&&typeof n.className=="string"&&(h.className+=" "+n.className),this._eventLayer.appendChild(h),{left:s,top:i,width:c,height:r,elmt:h}},t.prototype._createHighlightDiv=function(e,t,n){if(e>=0){var r=this._timeline.getDocument(),i=n.event,s=i.highlightColors[Math.min(e,i.highlightColors.length-1)],o=r.createElement("div");o.style.position="absolute",o.style.overflow="hidden",o.style.left=t.left-2+"px",o.style.width=t.width+4+"px",o.style.top=t.top-2+"px",o.style.height=t.height+4+"px",this._highlightLayer.appendChild(o)}},t.prototype._onClickMultiplePreciseInstantEvent=function(t,n,r){var i=e.DOM.getPageCoordinates(t);this._showBubble(i.left+Math.ceil(t.offsetWidth/2),i.top+Math.ceil(t.offsetHeight/2),r);var s=[];for(var o=0;o<r.length;o++)s.push(r[o].getID());return this._fireOnSelect(s),n.cancelBubble=!0,e.DOM.cancelEvent(n),!1},t.prototype._onClickInstantEvent=function(t,n,r){var i=e.DOM.getPageCoordinates(t);return this._showBubble(i.left+Math.ceil(t.offsetWidth/2),i.top+Math.ceil(t.offsetHeight/2),[r]),this._fireOnSelect([r.getID()]),n.cancelBubble=!0,e.DOM.cancelEvent(n),!1},t.prototype._onClickDurationEvent=function(t,n,r){if("pageX"in n)var i=n.pageX,s=n.pageY;else var o=e.DOM.getPageCoordinates(t),i=n.offsetX+o.left,s=n.offsetY+o.top;return this._showBubble(i,s,[r]),this._fireOnSelect([r.getID()]),n.cancelBubble=!0,e.DOM.cancelEvent(n),!1},t.prototype.showBubble=function(t){var n=this._eventIdToElmt[t.getID()];if(n){var r=e.DOM.getPageCoordinates(n);this._showBubble(r.left+n.offsetWidth/2,r.top+n.offsetHeight/2,[t])}},t.prototype._showBubble=function(t,n,r){var i=document.createElement("div");r="fillInfoBubble"in r?[r]:r;for(var s=0;s<r.length;s++){var o=document.createElement("div");i.appendChild(o),r[s].fillInfoBubble(o,this._params.theme,this._band.getLabeller())}e.WindowManager.cancelPopups(),e.Graphics.createBubbleForContentAndPoint(i,t,n,this._params.theme.event.bubble.width)},t.prototype._fireOnSelect=function(e){for(var t=0;t<this._onSelectListeners.length;t++)this._onSelectListeners[t](e)},t}),define("scripts/quarterly-ether-painter",["simile-ajax","./ether-interval-marker-layout","./ether-highlight"],function(e,t,n){var r=function(t){this._params=t,this._theme=t.theme,this._startDate=e.DateTime.parseGregorianDateTime(t.startDate)};return r.prototype.initialize=function(e,r){this._band=e,this._timeline=r,this._backgroundLayer=e.createLayerDiv(0),this._backgroundLayer.setAttribute("name","ether-background"),this._backgroundLayer.className="timeline-ether-bg",this._markerLayer=null,this._lineLayer=null;var i="align"in this._params?this._params.align:this._theme.ether.interval.marker[r.isHorizontal()?"hAlign":"vAlign"],s="showLine"in this._params?this._params.showLine:this._theme.ether.interval.line.show;this._intervalMarkerLayout=new t(this._timeline,this._band,this._theme,i,s),this._highlight=new n(this._timeline,this._band,this._theme,this._backgroundLayer)},r.prototype.setHighlight=function(e,t){this._highlight.position(e,t)},r.prototype.paint=function(){this._markerLayer&&this._band.removeLayerDiv(this._markerLayer),this._markerLayer=this._band.createLayerDiv(100),this._markerLayer.setAttribute("name","ether-markers"),this._markerLayer.style.display="none",this._lineLayer&&this._band.removeLayerDiv(this._lineLayer),this._lineLayer=this._band.createLayerDiv(1),this._lineLayer.setAttribute("name","ether-lines"),this._lineLayer.style.display="none";var t=new Date(0),n=this._band.getMaxDate();t.setUTCFullYear(Math.max(this._startDate.getUTCFullYear(),this._band.getMinDate().getUTCFullYear())),t.setUTCMonth(this._startDate.getUTCMonth());var r=this,i=function(e){e.setUTCMonth(e.getUTCMonth()+3)},s={labelInterval:function(e,t){var n=(4+(e.getUTCMonth()-r._startDate.getUTCMonth())/3)%4;return n!=0?{text:"Q"+(n+1),emphasized:!1}:{text:"Y"+(e.getUTCFullYear()-r._startDate.getUTCFullYear()+1),emphasized:!0}}};while(t.getTime()<n.getTime())this._intervalMarkerLayout.createIntervalMarker(t,s,e.DateTime.YEAR,this._markerLayer,this._lineLayer),i(t);this._markerLayer.style.display="block",this._lineLayer.style.display="block"},r.prototype.softPaint=function(){},r}),define("scripts/year-count-ether-painter",["simile-ajax","./ether-interval-marker-layout","./ether-highlight"],function(e,t,n){var r=function(t){this._params=t,this._theme=t.theme,this._startDate=e.DateTime.parseGregorianDateTime(t.startDate),this._multiple="multiple"in t?t.multiple:1};return r.prototype.initialize=function(e,r){this._band=e,this._timeline=r,this._backgroundLayer=e.createLayerDiv(0),this._backgroundLayer.setAttribute("name","ether-background"),this._backgroundLayer.className="timeline-ether-bg",this._markerLayer=null,this._lineLayer=null;var i="align"in this._params?this._params.align:this._theme.ether.interval.marker[r.isHorizontal()?"hAlign":"vAlign"],s="showLine"in this._params?this._params.showLine:this._theme.ether.interval.line.show;this._intervalMarkerLayout=new t(this._timeline,this._band,this._theme,i,s),this._highlight=new n(this._timeline,this._band,this._theme,this._backgroundLayer)},r.prototype.setHighlight=function(e,t){this._highlight.position(e,t)},r.prototype.paint=function(){this._markerLayer&&this._band.removeLayerDiv(this._markerLayer),this._markerLayer=this._band.createLayerDiv(100),this._markerLayer.setAttribute("name","ether-markers"),this._markerLayer.style.display="none",this._lineLayer&&this._band.removeLayerDiv(this._lineLayer),this._lineLayer=this._band.createLayerDiv(1),this._lineLayer.setAttribute("name","ether-lines"),this._lineLayer.style.display="none";var t=new Date(this._startDate.getTime()),n=this._band.getMaxDate(),r=this._band.getMinDate().getUTCFullYear()-this._startDate.getUTCFullYear();t.setUTCFullYear(this._band.getMinDate().getUTCFullYear()-r%this._multiple);var i=this,s=function(t){for(var n=0;n<i._multiple;n++)e.DateTime.incrementByInterval(t,e.DateTime.YEAR)},o={labelInterval:function(e,t){var n=e.getUTCFullYear()-i._startDate.getUTCFullYear();return{text:n,emphasized:n==0}}};while(t.getTime()<n.getTime())this._intervalMarkerLayout.createIntervalMarker(t,o,e.DateTime.YEAR,this._markerLayer,this._lineLayer),s(t);this._markerLayer.style.display="block",this._lineLayer.style.display="block"},r.prototype.softPaint=function(){},r}),define("timeline",["simile-ajax","./scripts/timeline-core","./scripts/timeline-impl","./scripts/event-utils","./scripts/labellers","./scripts/themes","./scripts/span-decorator","./scripts/point-decorator","./scripts/overview-painter","./scripts/hot-zone-ether","./scripts/linear-ether","./scripts/sources","./scripts/detailed-painter","./scripts/compact-painter","./scripts/ether-highlight","./scripts/ether-interval-marker-layout","./scripts/gregorian-ether-painter","./scripts/hot-zone-gregorian-ether-painter","./scripts/quarterly-ether-painter","./scripts/year-count-ether-painter","./scripts/original-painter","./scripts/band","jquery","module"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x){t.DateTime=e.DateTime,t._Impl=n,t.EventUtils=r,t.GregorianDateLabeller=i,t.ClassicTheme=s,t.SpanHighlightDecorator=o,t.PointHighlightDecorator=u,t.OverviewEventPainter=a,t.HotZoneEther=f,t.LinearEther=l,t.DefaultEventSource=c,t.DetailedEventPainter=h,t.CompactEventPainter=p,t.EtherHighlight=d,t.EtherIntervalMarkerLayout=v,t.GregorianEtherPainter=m,t.HotZoneGregorianEtherPainter=g,t.QuarterlyEtherPainter=y,t.YearCountEtherPainter=b,t.OriginalEventPainter=w,t._Band=E;var T=function(t,n){var r=t+" deprecated. "+n;e.Debug.warn(r)};if(document.location.search.length>0){var N=document.location.search.substr(1).split("&");for(var C=0;C<N.length;C++)N[C]=="timeline-use-local-resources"&&T("timeline-use-local-resources","When bundled, Timeline does not need to use local resources.  For development, use RequireJS to locate local resources.")}return t.load=function(){if(t.loaded)return;t.loaded=!0;var n=null,r=null,i=x.config();try{if(typeof Timeline_urlPrefix=="string")t.urlPrefix=Timeline_urlPrefix;else if(i.hasOwnProperty("prefix"))t.urlPrefix=i.prefix;else{var s=["timeline-api.js","timeline-bundle.js"];for(var o=0;o<s.length;o++){var u=s[o];r=e.findScript(document,u);if(r!==null){t.urlPrefix=r.substr(0,r.indexOf(u));break}}if(r===null)throw new Error("Failed to derive URL prefix for Timeline API code files")}t.urlPrefix.substr(-1)!=="/"&&(t.urlPrefix+="/");var a;typeof Timeline_parameters=="string"?a=e.parseURLParameters("?"+Timeline_parameters,t.params,t.paramTypes):r!==null?a=e.parseURLParameters(r,t.params,t.paramTypes):a=t.params,i.hasOwnProperty("bundle")&&(a.bundle=i.bundle),i.hasOwnProperty("ajax")&&(a.ajax=i.ajax,n=i.ajax),a.bundle?e.includeCssFile(document,t.urlPrefix+t.bundledCssFile):e.includeCssFiles(document,t.urlPrefix,t.cssFiles);if(typeof Timeline_ajax_url=="string")n=Timeline_ajax_url;else if(n===null){var f,l=null,c="timeline",s=["timeline-api.js","timeline-bundle.js"];for(var h=0;h<s.length;h++){f=e.findScript(document,s[h]);if(f!==null){l=f.substr(0,f.indexOf("/"+c+"/"));break}}l!==null&&(f.indexOf("/"+c+"/api/")>=0?n=l+"/ajax/api/":n=l+"/ajax/"+e.ajax_lib_version+"/")}n!==null?(a.ajax=n,e.load(),e.setPrefix(n)):e.load(),a.locales&&T("locales","Timeline either includes all localizations when bundled or retrieves them at need, specifying them is unnecessary.  This performance shortcut is no longer available."),a.forcedLocale&&T("forceLocale","To test out a locale, use RequireJS and specify the locale in the i18n config settings.  This develpoment settings is no longer available.  If you must force one language, re-bundle Timeline with only that language included."),a.defaultLocale&&T("defaultLocale","Timeline either includes all localizations when bundled or retrieves them at need, specifying a baseline default is unnecessary.  This shortcut setting is no longer available."),t.params=a;var p=function(e){for(var n=0;n<t.supportedLocales.length;n++)if(e==t.supportedLocales[n])return!0;return!1},d=function(e){if(p(e))return e;var t=e.indexOf("-");return t>0&&p(e.substr(0,t))?e.substr(0,t):null},v=t.params.defaultLocale,m=("language"in navigator?navigator.language:navigator.browserLanguage).split(";");for(var g=0;g<m.length;g++){var y=d(m[g]);if(y!=null){v=y;break}}t.clientLocale=v}catch(b){e.Debug.warn(b)}},S(document).ready(t.load),t});